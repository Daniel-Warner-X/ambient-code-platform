<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>session-1 - sample-workspace - Ambient Code Platform</title>
    <link rel="stylesheet" href="../../../styles.css">
    <style>
        .chat-container {
            height: 70vh;
            display: flex;
            flex-direction: column;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            font-size: 0.875rem;
            flex-shrink: 0;
        }
        
        .user-avatar {
            background: #64748b;
            color: white;
        }
        
        .ai-avatar {
            background: #1e40af;
            color: white;
        }
        
        .message-content {
            flex: 1;
            background: #f8fafc;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        
        .message-header {
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .chat-input {
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        
        .session-status {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="../../../index.html" class="logo">Ambient Code Platform</a>
                <div style="display: flex; align-items: center; gap: 2rem;">
                    
                    <div class="user-dropdown" style="position: relative;">
                        <button onclick="toggleUserDropdown()" class="user-dropdown-trigger" style="display: flex; align-items: center; gap: 0.5rem; color: #64748b; font-size: 0.875rem; background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 0.375rem; transition: background-color 0.2s;">
                            <div style="width: 24px; height: 24px; background: #64748b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 500; font-size: 0.75rem;">
                                DU
                            </div>
                            <span>demo-user@redhat.com</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="transition: transform 0.2s;" id="user-dropdown-arrow">
                                <path d="M6 9l6 6 6-6"/>
                            </svg>
                        </button>
                        <div id="userDropdownMenu" class="user-dropdown-menu" style="display: none; position: absolute; right: 0; top: 100%; background: white; border: 1px solid #e2e8f0; border-radius: 0.375rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); min-width: 200px; z-index: 1000; margin-top: 0.25rem;">
                            <div style="padding: 0.75rem; border-bottom: 1px solid #e2e8f0;">
                                <div style="font-weight: 500; color: #374151; font-size: 0.875rem;">demo-user@redhat.com</div>
                                <div style="color: #64748b; font-size: 0.75rem;">Demo User</div>
                            </div>
                            <div style="padding: 0.25rem;">
                                <a href="../../../integrations/page.html" style="width: 100%; text-align: left; padding: 0.5rem 0.75rem; background: none; border: none; cursor: pointer; border-radius: 0.25rem; color: #374151; font-size: 0.875rem; transition: background-color 0.2s; display: block; text-decoration: none;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 0.5rem; vertical-align: middle;">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                        <path d="M2 17l10 5 10-5"/>
                                        <path d="M2 12l10 5 10-5"/>
                                    </svg>
                                    Integrations
                                </a>
                                <hr style="margin: 0.25rem 0; border: none; border-top: 1px solid #e2e8f0;">
                                <button onclick="logout()" style="width: 100%; text-align: left; padding: 0.5rem 0.75rem; background: none; border: none; cursor: pointer; border-radius: 0.25rem; color: #374151; font-size: 0.875rem; transition: background-color 0.2s;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 0.5rem;">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16,17 21,12 16,7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="page-header">
        <div class="container">
            <div class="breadcrumbs">
                <a href="../../../index.html">Workspaces</a>
                <span>/</span>
                <a href="../page.html">sample-workspace</a>
                <span>/</span>
                <span>session-1</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <h1 class="page-title">Interactive Session: session-1</h1>
                    <span class="badge badge-info" style="white-space: nowrap;">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; margin-right: 0.25rem;">
                            <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                        </svg>
                        Running
                    </span>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        Clone
                    </button>
                    <button onclick="stopSession()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; color: #dc2626; border-color: #dc2626;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                        </svg>
                        Stop
                    </button>
                </div>
            </div>
            <p class="page-description">Real-time AI coding session ‚Ä¢ claude-3.5-sonnet ‚Ä¢ Started just now</p>
        </div>
    </div>

    <main class="container" style="margin-top: 2rem;">
        <div style="display: grid; grid-template-columns: 380px 1fr; gap: 1.5rem; height: 75vh;">
            <!-- Left Column: Accordions -->
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <!-- Workflow Accordion -->
                <div class="accordion-item">
                    <button onclick="toggleAccordion('workflow')" class="accordion-header">
                        <span>Workflows</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="workflow-arrow" style="transform: rotate(180deg);">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="workflow-content" class="accordion-content" style="display: block;">
                        <div style="padding: 1rem;">
                            <div class="form-group">
                                <label class="form-label" style="font-size: 0.875rem;">Select a Workflow</label>
                                <select id="workflow-type" class="form-input" style="font-size: 0.875rem;" onchange="updateWorkflowPhases()">
                                    <option value="default" selected>None selected</option>
                                    <option value="create-rfe">Plan a feature</option>
                                    <option value="create-feature">Develop Feature</option>
                                </select>
                            </div>

                            <!-- Help text when None is selected -->
                            <div id="workflow-help-text" style="margin-top: 1rem; font-size: 0.875rem; color: #64748b;">
                                <div>Workflows provide a structured processes for Ambient Code Platform agents to follow and achieve complex goals.</div>
                            </div>

                            <!-- RFE Phases (shown when Create RFE is selected) -->
                            <div id="rfe-phases" style="display: none; margin-top: 1rem;">
                                <!-- Repository requirement message -->
                                <div id="rfe-repo-requirement" style="padding: 1rem; text-align: center;">
                                    <div style="color: #64748b; font-size: 0.875rem;">
                                        A spec repository is required to store artifacts for this workflow.
                                    </div>
                                </div>

                                <div style="font-size: 0.875rem; border: 1px solid #e2e8f0; border-radius: 0.375rem; overflow: hidden;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">üí°</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Ideate</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">Iterate your idea</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /ideate command" onclick="runIdeateCommand()">/ideate</button>
                                    </div>

                                    <div id="feasibility-step" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc; opacity: 0.6;">
                                        <span style="font-size: 1.25rem;">üîí</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Feasibility</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">idea.md is required</div>
                                        </div>
                                        <button id="feasibility-button" class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.3; cursor: not-allowed;" disabled title="Complete Ideate step first" onclick="runFeasibilityCommand()">/feasibility</button>
                                    </div>

                                    <div id="describe-step" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: #f8fafc; opacity: 0.6;">
                                        <span style="font-size: 1.25rem;">üîí</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Describe</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">feasibility.md is required</div>
                                        </div>
                                        <button id="describe-button" class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.3; cursor: not-allowed;" disabled title="Complete Feasibility step first" onclick="runDescribeCommand()">/describe</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Spec Kit Phases (shown when Create Feature is selected) -->
                            <div id="spec-kit-phases" style="display: none; margin-top: 1rem;">
                                <!-- Repository requirement message -->
                                <div id="spec-kit-repo-requirement" style="padding: 1rem; text-align: center;">
                                    <div style="color: #64748b; font-size: 0.875rem;">
                                        A spec repository is required to store artifacts for this workflow.
                                    </div>
                                </div>

                                <div style="font-size: 0.875rem; border: 1px solid #e2e8f0; border-radius: 0.375rem; overflow: hidden;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">üîç</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Analyze</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">Analyze existing specifications</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /analyze command" onclick="runAnalyzeCommand()">/analyze</button>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">‚ùì</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Clarify</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">Clarify underspecified areas</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /clarify command" onclick="runClarifyCommand()">/clarify</button>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">üìù</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Specify</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">Create or update spec.md file</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /specify command" onclick="runSpecifyCommand()">/specify</button>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">üìã</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Plan</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">plan.md</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /plan command">/plan</button>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; background: white;">
                                        <span style="font-size: 1.25rem;">‚úÖ</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Tasks</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">tasks.md</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /tasks command">/tasks</button>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: white;">
                                        <span style="font-size: 1.25rem;">üèóÔ∏è</span>
                                        <div style="flex: 1;">
                                            <div class="workflow-step-name" style="font-weight: 500; color: #9ca3af;">Implement</div>
                                            <div class="workflow-step-filename" style="font-size: 0.75rem; color: #cbd5e1;">implement</div>
                                        </div>
                                        <button class="btn btn-secondary workflow-step-button" style="padding: 0.25rem 0.5rem; font-size: 0.75rem; opacity: 0.5; cursor: not-allowed;" disabled title="Run the /implement command">/implement</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Spec Repository Accordion -->
                <div class="accordion-item">
                    <button onclick="toggleAccordion('spec-repository')" class="accordion-header">
                        <span>Spec Repository</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="spec-repository-arrow">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="spec-repository-content" class="accordion-content" style="display: none;">
                        <div style="padding: 1rem; text-align: center;">
                            <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">
                                A spec repository is required to store agent config and workflow artifacts.
                            </div>
                            <button onclick="openGitCredentialsModal()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                                    <path d="M12 5v14"/>
                                    <path d="M5 12h14"/>
                                </svg>
                                Add Spec Repository
                            </button>
                        </div>

                        <!-- Hidden content (will show after Git configuration) -->
                        <div id="repository-details" style="display: none; padding: 1rem;">
                            <!-- Spec Repo URL and Base Branch -->
                            <div style="margin-bottom: 1.5rem;">
                                <div class="form-group" style="margin-bottom: 1rem;">
                                    <label class="form-label" style="font-size: 0.875rem;">Spec Repo URL</label>
                                    <div style="color: #64748b; font-size: 0.75rem; margin-bottom: 0.5rem;">The spec repository is where workflow artifacts are stored.</div>
                                    <input type="text" class="form-input" placeholder="https://github.com/org/repo.git" style="font-size: 0.875rem;">
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label" style="font-size: 0.875rem;">Spec repo base branch</label>
                                            <input type="text" class="form-input" value="main" style="font-size: 0.875rem;">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div style="display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1.5rem;">
                                <button onclick="cancelRepositoryConfig()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Cancel</button>
                                <button onclick="saveRepositoryConfig()" class="btn btn-primary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Save</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agents Accordion -->
                <div class="accordion-item" id="agents-accordion">
                    <button onclick="toggleAccordion('agents')" class="accordion-header" id="agents-accordion-button">
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span>Agents</span>
                            <span id="agents-count-badge" class="badge" style="background: #10b981; color: white; display: none;">0</span>
                        </span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="agents-arrow">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="agents-content" class="accordion-content" style="display: none;">
                        <!-- Message shown when no repository is seeded -->
                        <div id="agents-repo-requirement" style="padding: 1rem; text-align: center;">
                            <div style="color: #64748b; font-size: 0.875rem;">
                                A spec repository is required to store agent config.
                            </div>
                        </div>

                        <!-- Agent list (hidden until repository is seeded) -->
                        <div id="agents-list" style="display: none; padding: 1rem; font-size: 0.875rem;">
                            <!-- Dynamic selection option -->
                            <div style="margin-bottom: 0.75rem; padding: 0.5rem; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 0.375rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.8125rem;">
                                    <input type="checkbox" id="dynamic-agent-selection" style="cursor: pointer;" checked>
                                    <span style="color: #374151;"><strong>Let ACP dynamically select agents</strong></span>
                                </label>
                            </div>

                            <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 0.75rem 0;">

                            <div style="margin-bottom: 0.75rem; color: #64748b; font-size: 0.75rem;">
                                Select specific agents to include in this session
                            </div>

                            <div style="display: flex; flex-direction: column; gap: 0.25rem; max-height: 300px; overflow-y: auto; padding-right: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Archie</strong> - Architect</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Aria</strong> - UX Architect</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Casey</strong> - Content Strategist</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Dan</strong> - Senior Director</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Diego</strong> - Program Manager</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Emma</strong> - Engineering Manager</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Felix</strong> - UX Feature Lead</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Jack</strong> - Delivery Owner</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Lee</strong> - Team Lead</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Neil</strong> - Test Engineer</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Olivia</strong> - Product Owner</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Parker</strong> - Product Manager</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Phoenix</strong> - PXE Specialist</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Ryan</strong> - UX Researcher</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Sam</strong> - Scrum Master</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Stella</strong> - Staff Engineer</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Steve</strong> - UX Designer</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Taylor</strong> - Team Member</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Terry</strong> - Technical Writer</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Tessa</strong> - Writing Manager</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; padding: 0.25rem; border-radius: 0.25rem; transition: background-color 0.2s; font-size: 0.8125rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
                                    <input type="checkbox" style="cursor: pointer;" onchange="updateAgentCountBadge()">
                                    <span style="color: #374151;"><strong>Uma</strong> - UX Team Lead</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Associated Repositories Accordion -->
                <div class="accordion-item">
                    <button onclick="toggleAccordion('associated-repositories')" class="accordion-header">
                        <span>Context</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="associated-repositories-arrow">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="associated-repositories-content" class="accordion-content" style="display: none;">
                        <div style="padding: 1rem; text-align: center;">
                            <div style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">
                                No associated repositories configured
                            </div>
                            <button class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                                    <path d="M12 5v14"/>
                                    <path d="M5 12h14"/>
                                </svg>
                                Add Repository
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Accordion -->
                <div class="accordion-item">
                    <button onclick="toggleAccordion('results')" class="accordion-header">
                        <span>Results</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="results-arrow">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="results-content" class="accordion-content" style="display: none;">
                        <div style="padding: 1rem; font-size: 0.875rem; color: #64748b; text-align: center;">
                            No results yet
                        </div>
                    </div>
                </div>

                <!-- Session Details Accordion -->
                <div class="accordion-item">
                    <button onclick="toggleAccordion('session-details')" class="accordion-header">
                        <span>Session Details</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="session-details-arrow">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </button>
                    <div id="session-details-content" class="accordion-content" style="display: none;">
                        <div style="padding: 1rem; font-size: 0.875rem; color: #64748b;">
                            <div style="margin-bottom: 0.5rem;"><strong>Model:</strong> claude-3.5-sonnet</div>
                            <div style="margin-bottom: 0.5rem;"><strong>Mode:</strong> Interactive</div>
                            <div style="margin-bottom: 0.5rem;"><strong>Started:</strong> Just now</div>
                            <div style="margin-bottom: 0.5rem;"><strong>Duration:</strong> 342567ms</div>
                            <div style="margin-bottom: 0.5rem;"><strong>K8s Job:</strong> agentic-session-1760582922-job</div>
                            <div style="margin-bottom: 0.5rem;"><strong>Messages:</strong> <span id="message-count">1</span></div>
                            <div><strong>Session prompt:</strong> <a href="#" onclick="viewSessionPrompt(); return false;" style="color: #1e40af; text-decoration: underline; cursor: pointer;">view</a></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Chat -->
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="message">
                        <div class="message-avatar ai-avatar">ACP</div>
                        <div class="message-content">
                            <div class="message-header">ACP</div>
                            <div id="welcome-message"></div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input" style="position: relative;">
                    <!-- Command Popover -->
                    <div id="command-popover" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); min-width: 250px; margin-bottom: 0.5rem; overflow: hidden;">
                        <div style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <div style="font-size: 0.75rem; font-weight: 500; color: #64748b;">COMMANDS</div>
                        </div>
                        <div onclick="selectCommand('help')" style="padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                            <div>
                                <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/help</div>
                                <div style="font-size: 0.75rem; color: #64748b;">Guidance for using ACP</div>
                            </div>
                        </div>
                        <div id="workflow-commands-container">
                            <div id="no-workflow-message" style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">
                                No workflow-specific commands available
                            </div>
                            <div id="command-ideate" onclick="selectCommand('ideate')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/ideate</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Iterate your idea</div>
                                </div>
                            </div>
                            <div id="command-feasibility" onclick="selectCommand('feasibility')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/feasibility</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Assess technical feasibility</div>
                                </div>
                            </div>
                            <div id="command-describe" onclick="selectCommand('describe')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/describe</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Create detailed specification</div>
                                </div>
                            </div>
                            <div id="command-analyze" onclick="selectCommand('analyze')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/analyze</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Analyze existing specifications</div>
                                </div>
                            </div>
                            <div id="command-clarify" onclick="selectCommand('clarify')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/clarify</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Clarify underspecified areas</div>
                                </div>
                            </div>
                            <div id="command-specify" onclick="selectCommand('specify')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/specify</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Create specifications</div>
                                </div>
                            </div>
                            <div id="command-plan" onclick="selectCommand('plan')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/plan</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Generate implementation plan</div>
                                </div>
                            </div>
                            <div id="command-tasks" onclick="selectCommand('tasks')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/tasks</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Break down into tasks</div>
                                </div>
                            </div>
                            <div id="command-implement" onclick="selectCommand('implement')" style="display: none; padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; align-items: center; gap: 0.75rem;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                                <div>
                                    <div style="font-weight: 500; font-size: 0.875rem; color: #374151;">/implement</div>
                                    <div style="font-size: 0.75rem; color: #64748b;">Execute implementation</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Popover -->
                    <div id="agent-popover" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); min-width: 300px; max-height: 400px; margin-bottom: 0.5rem; overflow: hidden;">
                        <div style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <div style="font-size: 0.75rem; font-weight: 500; color: #64748b;">AGENTS</div>
                        </div>
                        <div id="agent-popover-content" style="overflow-y: auto; max-height: 350px;">
                            <!-- Content will be dynamically populated -->
                        </div>
                    </div>

                    <!-- Context Popover -->
                    <div id="context-popover" style="display: none; position: absolute; bottom: 100%; left: 0; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); min-width: 300px; max-height: 400px; margin-bottom: 0.5rem; overflow: hidden;">
                        <div style="padding: 0.5rem; border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <div style="font-size: 0.75rem; font-weight: 500; color: #64748b;">CONTEXT FILES</div>
                        </div>
                        <div id="context-popover-content" style="overflow-y: auto; max-height: 350px;">
                            <!-- Content will be dynamically populated -->
                        </div>
                    </div>

                    <input type="text" id="chat-input-field" placeholder="/ for commands, # for agents, @ for context" style="flex: 1;" oninput="handleChatInput(event)" onkeypress="handleKeyPress(event)">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13"/>
                            <path d="M22 2l-7 20-4-9-9-4z"/>
                        </svg>
                        Send
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Git Credentials Modal -->
    <div id="gitCredentialsModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <div>
                    <h2>Connect to GitHub</h2>
                    <p style="font-size: 0.875rem; color: #64748b; margin-top: 0.25rem;">You can modify or remove these credentials anytime in project settings</p>
                </div>
                <button onclick="closeGitCredentialsModal()" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label class="form-label" for="git-user-name">Git User Name</label>
                        <input type="text" id="git-user-name" class="form-input" placeholder="your-github-username">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="git-user-email">Git User Email</label>
                        <input type="email" id="git-user-email" class="form-input" placeholder="your-email@example.com">
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" for="github-token">GitHub API Token</label>
                    <div style="position: relative;">
                        <input type="password" id="github-token" class="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="padding-right: 3rem;">
                        <button type="button" onclick="togglePasswordVisibility()" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </button>
                    </div>
                    <small style="color: #64748b; font-size: 0.875rem;">GitHub personal access token or fine-grained token for git operations and API access</small>
                </div>
                
                <div style="font-size: 0.875rem; color: #64748b; margin-bottom: 1.5rem;">
                    Git credentials will be saved with keys: GIT_USER_NAME, GIT_USER_EMAIL, GIT_TOKEN
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" onclick="closeGitCredentialsModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="saveGitCredentials()" class="btn btn-primary">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variable to track selected workflow
        var selectedWorkflow = null;

        // Global variable to track if repository is seeded
        var isRepositorySeeded = false;

        // Function to show workflow commands based on selected workflow
        function showWorkflowCommands(workflowType) {
            selectedWorkflow = workflowType;

            var noWorkflowMessage = document.getElementById('no-workflow-message');
            var commandIdeate = document.getElementById('command-ideate');
            var commandFeasibility = document.getElementById('command-feasibility');
            var commandDescribe = document.getElementById('command-describe');
            var commandAnalyze = document.getElementById('command-analyze');
            var commandClarify = document.getElementById('command-clarify');
            var commandSpecify = document.getElementById('command-specify');
            var commandPlan = document.getElementById('command-plan');
            var commandTasks = document.getElementById('command-tasks');
            var commandImplement = document.getElementById('command-implement');

            // Check if spec repo has been added
            var repoDetails = document.getElementById('repository-details');
            var hasSpecRepo = repoDetails && repoDetails.style.display !== 'none';

            // If no spec repo, hide all workflow commands regardless of workflow type
            if (!hasSpecRepo) {
                if (noWorkflowMessage) {
                    noWorkflowMessage.style.display = 'block';
                    noWorkflowMessage.textContent = 'Add a spec repository to enable workflow commands';
                }
                if (commandIdeate) commandIdeate.style.display = 'none';
                if (commandFeasibility) commandFeasibility.style.display = 'none';
                if (commandDescribe) commandDescribe.style.display = 'none';
                if (commandAnalyze) commandAnalyze.style.display = 'none';
                if (commandClarify) commandClarify.style.display = 'none';
                if (commandSpecify) commandSpecify.style.display = 'none';
                if (commandPlan) commandPlan.style.display = 'none';
                if (commandTasks) commandTasks.style.display = 'none';
                if (commandImplement) commandImplement.style.display = 'none';
                return;
            }

            if (!workflowType || workflowType === 'default') {
                // No workflow selected - show message, hide commands
                if (noWorkflowMessage) {
                    noWorkflowMessage.style.display = 'block';
                    noWorkflowMessage.textContent = 'No workflow-specific commands available';
                }
                if (commandIdeate) commandIdeate.style.display = 'none';
                if (commandFeasibility) commandFeasibility.style.display = 'none';
                if (commandDescribe) commandDescribe.style.display = 'none';
                if (commandAnalyze) commandAnalyze.style.display = 'none';
                if (commandClarify) commandClarify.style.display = 'none';
                if (commandSpecify) commandSpecify.style.display = 'none';
                if (commandPlan) commandPlan.style.display = 'none';
                if (commandTasks) commandTasks.style.display = 'none';
                if (commandImplement) commandImplement.style.display = 'none';
            } else if (workflowType === 'create-rfe') {
                // Plan a Feature workflow - show ideate, feasibility, describe
                if (noWorkflowMessage) noWorkflowMessage.style.display = 'none';
                if (commandIdeate) commandIdeate.style.display = 'flex';
                if (commandFeasibility) commandFeasibility.style.display = 'flex';
                if (commandDescribe) commandDescribe.style.display = 'flex';
                if (commandAnalyze) commandAnalyze.style.display = 'none';
                if (commandClarify) commandClarify.style.display = 'none';
                if (commandSpecify) commandSpecify.style.display = 'none';
                if (commandPlan) commandPlan.style.display = 'none';
                if (commandTasks) commandTasks.style.display = 'none';
                if (commandImplement) commandImplement.style.display = 'none';
            } else if (workflowType === 'create-feature') {
                // Develop Feature workflow - show analyze, clarify, specify, plan, tasks, implement
                if (noWorkflowMessage) noWorkflowMessage.style.display = 'none';
                if (commandIdeate) commandIdeate.style.display = 'none';
                if (commandFeasibility) commandFeasibility.style.display = 'none';
                if (commandDescribe) commandDescribe.style.display = 'none';
                if (commandAnalyze) commandAnalyze.style.display = 'flex';
                if (commandClarify) commandClarify.style.display = 'flex';
                if (commandSpecify) commandSpecify.style.display = 'flex';
                if (commandPlan) commandPlan.style.display = 'flex';
                if (commandTasks) commandTasks.style.display = 'flex';
                if (commandImplement) commandImplement.style.display = 'flex';
            }
        }

        // User dropdown functionality
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            const arrow = document.getElementById('user-dropdown-arrow');
            const isOpen = dropdown.style.display === 'block';
            
            if (isOpen) {
                dropdown.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
            } else {
                dropdown.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        function logout() {
            // Close dropdown first
            document.getElementById('userDropdownMenu').style.display = 'none';
            document.getElementById('user-dropdown-arrow').style.transform = 'rotate(0deg)';
            
            // Simulate logout (in real app, this would redirect to login page)
            alert('Logged out successfully!');
        }

        // Session control functions
        function stopSession() {
            // Update status badge
            const statusBadge = document.querySelector('.badge-info');
            if (statusBadge) {
                statusBadge.className = 'badge';
                statusBadge.style.background = '#f1f5f9';
                statusBadge.style.color = '#64748b';
                statusBadge.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                    </svg>
                    Stopped
                `;
            }
            
            // Update page description
            const description = document.querySelector('.page-description');
            if (description) {
                description.textContent = 'Real-time AI coding session ‚Ä¢ claude-3.5-sonnet ‚Ä¢ Stopped just now';
            }
            
            // Disable chat input
            const chatInput = document.querySelector('.chat-input input');
            const sendButton = document.querySelector('.chat-input button');
            if (chatInput && sendButton) {
                chatInput.disabled = true;
                chatInput.placeholder = 'Session stopped - no new messages';
                chatInput.style.background = '#f8fafc';
                chatInput.style.color = '#64748b';
                sendButton.disabled = true;
            }
            
            // Change Stop button to Export
            const stopButton = document.querySelector('[onclick="stopSession()"]');
            if (stopButton) {
                stopButton.onclick = null;
                stopButton.style.color = '';
                stopButton.style.borderColor = '';
                stopButton.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export
                `;
            }
        }

        // Accordion toggle function
        function toggleAccordion(accordionName) {
            // Check if the accordion is disabled (for agents)
            const button = document.getElementById(`${accordionName}-accordion-button`);
            if (button && button.disabled) {
                return; // Don't toggle if disabled
            }

            const content = document.getElementById(`${accordionName}-content`);
            const arrow = document.getElementById(`${accordionName}-arrow`);

            if (content && arrow) {
                const isOpen = content.style.display === 'block';

                if (isOpen) {
                    content.style.display = 'none';
                    arrow.style.transform = 'rotate(0deg)';
                } else {
                    content.style.display = 'block';
                    arrow.style.transform = 'rotate(180deg)';
                }
            }
        }

        // Enable the Agents accordion after repository is seeded
        function enableAgentsAccordion() {
            // Hide the requirement message
            const agentsRepoRequirement = document.getElementById('agents-repo-requirement');
            if (agentsRepoRequirement) {
                agentsRepoRequirement.style.display = 'none';
            }

            // Show the agent list
            const agentsList = document.getElementById('agents-list');
            if (agentsList) {
                agentsList.style.display = 'block';
            }
        }

        // Enable workflow step buttons after repository is seeded
        function enableWorkflowSteps() {
            const workflowButtons = document.querySelectorAll('.workflow-step-button');
            workflowButtons.forEach(button => {
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
            });

            // Change step names from gray to black
            const stepNames = document.querySelectorAll('.workflow-step-name');
            stepNames.forEach(name => {
                name.style.color = '#374151';
            });

            // Change filenames from light gray to darker gray
            const fileNames = document.querySelectorAll('.workflow-step-filename');
            fileNames.forEach(filename => {
                filename.style.color = '#64748b';
            });
        }

        // Update workflow phases based on selected workflow type
        function updateWorkflowPhases() {
            const workflowType = document.getElementById('workflow-type').value;
            const rfePhases = document.getElementById('rfe-phases');
            const specKitPhases = document.getElementById('spec-kit-phases');
            const helpText = document.getElementById('workflow-help-text');

            // Hide all phases and help text first
            rfePhases.style.display = 'none';
            specKitPhases.style.display = 'none';
            if (helpText) helpText.style.display = 'none';

            // Show appropriate content based on selection
            if (workflowType === 'default') {
                // Show help text for None/Default
                if (helpText) helpText.style.display = 'block';
            } else if (workflowType === 'create-rfe') {
                rfePhases.style.display = 'block';
            } else if (workflowType === 'create-feature') {
                specKitPhases.style.display = 'block';
            }

            // Update command popover to show appropriate commands
            showWorkflowCommands(workflowType);
        }

        // Show Add Repository form in chat
        function showAddRepositoryForm() {
            const chatMessages = document.querySelector('.chat-messages');
            
            const gitIntegrationCard = document.createElement('div');
            gitIntegrationCard.style.cssText = 'margin-bottom: 1rem; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1.5rem; max-width: 600px; opacity: 0; transition: opacity 0.3s ease-in;';
            
            gitIntegrationCard.innerHTML = `
                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Connect to spec repository</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div class="form-group">
                        <label class="form-label" style="font-size: 0.875rem;">Git User Name</label>
                        <input type="text" class="form-input" value="Daniel-Warner-X" style="font-size: 0.875rem;">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="font-size: 0.875rem;">Git User Email</label>
                        <input type="email" class="form-input" value="dan@danielwarner.net" style="font-size: 0.875rem;">
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="font-size: 0.875rem;">GitHub API Token</label>
                    <div style="position: relative;">
                        <input type="password" class="form-input" value="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="font-size: 0.875rem; padding-right: 3rem;">
                        <button style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </button>
                    </div>
                    <small style="color: #64748b; font-size: 0.75rem;">GitHub personal access token or fine-grained token for git operations and API access</small>
                </div>
                
                <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 1rem;">
                    Git credentials will be saved with keys: GIT_USER_NAME, GIT_USER_EMAIL, GIT_TOKEN
                </div>
                
                <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                    <button onclick="closeGitIntegration(this)" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Cancel</button>
                    <button onclick="saveGitIntegration(this)" class="btn btn-primary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Save Configuration</button>
                </div>
            `;
            
            chatMessages.appendChild(gitIntegrationCard);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Fade in the card
            setTimeout(() => {
                gitIntegrationCard.style.opacity = '1';
            }, 50);
        }

        function closeGitIntegration(button) {
            const card = button.closest('div[style*="max-width: 600px"]');
            if (card) {
                card.remove();
            }
        }

        function saveGitIntegration(button) {
            const card = button.closest('div[style*="max-width: 600px"]');
            if (card) {
                // Show success message
                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: #f0fdf4; border: 1px solid #10b981; border-radius: 0.375rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        <div>
                            <div style="font-weight: 500; color: #166534;">Git Integration Configured</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Repository credentials saved successfully</div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    card.remove();
                }, 3000);
            }
        }

        // Typing animation for welcome message
        function typeMessage(element, text, speed = 15, callback) {
            let index = 0;
            element.textContent = '';

            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    setTimeout(type, speed);
                } else if (callback) {
                    callback();
                }
            }

            type();
        }

        // Show workflow suggestion cards
        function showWorkflowCards() {
            const chatMessages = document.getElementById('chat-messages');

            const cardsContainer = document.createElement('div');
            cardsContainer.style.cssText = 'display: flex; gap: 1rem; margin-top: 1rem; margin-bottom: 1.5rem; padding: 0 1rem; opacity: 0; transition: opacity 0.3s ease-in;';
            cardsContainer.id = 'workflow-cards';
            
            cardsContainer.innerHTML = `
                <div style="flex: 1; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1e40af'; this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.1)'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'" onclick="selectWorkflow('rfe')">
                    <div style="font-weight: 500; color: #374151; margin-bottom: 0.25rem;"><span style="font-size: 1.25rem; margin-right: 0.5rem;">üìù</span>Plan a feature</div>
                    <div style="font-size: 0.75rem; color: #64748b;">Create a detailed request for enhancement</div>
                </div>

                <div style="flex: 1; background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1e40af'; this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.1)'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'" onclick="selectWorkflow('feature')">
                    <div style="font-weight: 500; color: #374151; margin-bottom: 0.25rem;"><span style="font-size: 1.25rem; margin-right: 0.5rem;">üèóÔ∏è</span>Develop Feature</div>
                    <div style="font-size: 0.75rem; color: #64748b;">Complete feature development from spec to implementation</div>
                </div>
            `;
            
            chatMessages.appendChild(cardsContainer);
            
            // Fade in the cards
            setTimeout(() => {
                cardsContainer.style.opacity = '1';
            }, 50);
        }

        // Handle workflow selection from cards
        function selectWorkflow(workflowType) {
            // Set the workflow dropdown
            const workflowDropdown = document.getElementById('workflow-type');
            if (workflowDropdown) {
                if (workflowType === 'rfe') {
                    workflowDropdown.value = 'create-rfe';
                } else if (workflowType === 'feature') {
                    workflowDropdown.value = 'create-feature';
                }
                updateWorkflowPhases();
                
                // Open the workflow accordion
                const workflowContent = document.getElementById('workflow-content');
                const workflowArrow = document.getElementById('workflow-arrow');
                if (workflowContent && workflowArrow) {
                    workflowContent.style.display = 'block';
                    workflowArrow.style.transform = 'rotate(180deg)';
                }
            }
            
            // Remove the workflow cards
            const cards = document.getElementById('workflow-cards');
            if (cards) {
                cards.style.opacity = '0';
                setTimeout(() => {
                    cards.remove();
                    
                    // Show system message about workflow selection
                    const chatMessages = document.getElementById('chat-messages');
                    const systemMessage = document.createElement('div');
                    systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
                    
                    const workflowName = workflowType === 'rfe' ? 'Feature planning workflow' : 'Create feature with spec-kit workflow';
                    systemMessage.innerHTML = `
                        <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                            ${workflowName} selected
                        </div>
                    `;
                    
                    chatMessages.appendChild(systemMessage);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Show repository requirement message after system message
                    setTimeout(() => {
                        showRepositoryRequirement();
                    }, 500);
                }, 300);
            }
        }

        // Show repository requirement message in chat
        function showRepositoryRequirement() {
            const chatMessages = document.getElementById('chat-messages');
            
            // Add ACP message about repository requirement
            const repoMessage = document.createElement('div');
            repoMessage.className = 'message';
            repoMessage.innerHTML = `
                <div class="message-avatar ai-avatar">ACP</div>
                <div class="message-content">
                    <div class="message-header">ACP</div>
                    <div id="repo-requirement-message"></div>
                    <div id="repo-action-button" style="opacity: 0; transition: opacity 0.3s ease-in; margin-top: 1rem;"></div>
                </div>
            `;
            
            chatMessages.appendChild(repoMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Type the message
            const messageElement = document.getElementById('repo-requirement-message');
            const messageText = "This workflow requires a spec repository to store generated artifacts.";

            typeMessage(messageElement, messageText, 10, function() {
                // Show Add Repository button after typing completes
                setTimeout(() => {
                    const buttonContainer = document.getElementById('repo-action-button');
                    if (buttonContainer) {
                        buttonContainer.innerHTML = `
                            <button onclick="openGitCredentialsModal()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">
                                    <path d="M12 5v14"/>
                                    <path d="M5 12h14"/>
                                </svg>
                                Add Repository
                            </button>
                        `;
                        
                        // Fade in the button
                        setTimeout(() => {
                            buttonContainer.style.opacity = '1';
                        }, 50);
                    }
                }, 1000);
            });
        }

        // Show Git Integration form inside ACP message
        function showGitIntegrationInMessage() {
            const container = document.getElementById('git-integration-container');
            if (!container) return;
            
            container.innerHTML = `
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1.5rem;">
                    <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Connect to spec repository</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label" style="font-size: 0.875rem;">Git User Name</label>
                            <input type="text" class="form-input" value="Daniel-Warner-X" style="font-size: 0.875rem;">
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="font-size: 0.875rem;">Git User Email</label>
                            <input type="email" class="form-input" value="dan@danielwarner.net" style="font-size: 0.875rem;">
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label class="form-label" style="font-size: 0.875rem;">GitHub API Token</label>
                        <div style="position: relative;">
                            <input type="password" class="form-input" value="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxx" style="font-size: 0.875rem; padding-right: 3rem;">
                            <button style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                        <small style="color: #64748b; font-size: 0.75rem;">GitHub personal access token or fine-grained token for git operations and API access</small>
                    </div>
                    
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 1rem;">
                        Git credentials will be saved with keys: GIT_USER_NAME, GIT_USER_EMAIL, GIT_TOKEN
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                        <button onclick="cancelGitIntegrationInMessage()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Cancel</button>
                        <button onclick="saveGitIntegrationInMessage()" class="btn btn-primary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Save Configuration</button>
                    </div>
                </div>
            `;
            
            // Fade in the card
            setTimeout(() => {
                container.style.opacity = '1';
            }, 50);
            
            // Scroll to show the card
            const chatMessages = document.querySelector('.chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function cancelGitIntegrationInMessage() {
            const container = document.getElementById('git-integration-container');
            if (container) {
                container.style.opacity = '0';
                setTimeout(() => {
                    container.innerHTML = '';
                }, 500);
            }
        }

        function saveGitIntegrationInMessage() {
            const container = document.getElementById('git-integration-container');
            if (container) {
                container.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: #f0fdf4; border: 1px solid #10b981; border-radius: 0.375rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                        <div>
                            <div style="font-weight: 500; color: #166534;">Git Integration Configured</div>
                            <div style="font-size: 0.875rem; color: #64748b;">Repository credentials saved successfully</div>
                        </div>
                    </div>
                `;
                
                // Show repository details in the accordion
                const repoDetails = document.getElementById('repository-details');
                if (repoDetails) {
                    repoDetails.style.display = 'block';
                }
            }
        }

        // Git Credentials Modal functions
        function openGitCredentialsModal() {
            // Hide the Add Repository button in chat if it exists
            const repoActionButton = document.getElementById('repo-action-button');
            if (repoActionButton) {
                repoActionButton.style.opacity = '0';
                setTimeout(() => {
                    repoActionButton.style.display = 'none';
                }, 500);
            }
            
            document.getElementById('gitCredentialsModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeGitCredentialsModal() {
            document.getElementById('gitCredentialsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function togglePasswordVisibility() {
            const tokenInput = document.getElementById('github-token');
            if (tokenInput.type === 'password') {
                tokenInput.type = 'text';
            } else {
                tokenInput.type = 'password';
            }
        }

        function saveGitCredentials() {
            const modalBody = document.querySelector('#gitCredentialsModal .modal-body');
            
            // Show loading state
            modalBody.innerHTML = `
                <div style="text-align: center; padding: 3rem 2rem;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#1e40af" stroke-width="2" style="animation: spin 1s linear infinite; margin: 0 auto 1rem;">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                    <div style="font-weight: 500; font-size: 1rem; color: #374151; margin-bottom: 0.5rem;">Connecting to GitHub</div>
                    <div style="font-size: 0.875rem; color: #64748b;">Verifying credentials...</div>
                </div>
            `;
            
            // After 5 seconds, show spec repository configuration
            setTimeout(() => {
                showSpecRepoConfig();
            }, 5000);
        }

        function showSpecRepoConfig() {
            const modalBody = document.querySelector('#gitCredentialsModal .modal-body');
            const modalTitle = document.querySelector('#gitCredentialsModal h2');
            
            // Update modal title
            if (modalTitle) {
                modalTitle.textContent = 'Configure Spec Repository';
            }
            
            // Show spec repository form
            modalBody.innerHTML = `
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" for="spec-repo-url">Spec Repo URL</label>
                    <input type="text" id="spec-repo-url" class="form-input" placeholder="https://github.com/org/repo.git">
                    <small style="color: #64748b; font-size: 0.875rem;">The spec repository is where workflow artifacts are stored.</small>
                </div>
                
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label class="form-label" for="spec-base-branch">Base Branch</label>
                    <input type="text" id="spec-base-branch" class="form-input" value="main">
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" onclick="closeGitCredentialsModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="saveSpecRepoConfig()" class="btn btn-primary">Save Configuration</button>
                </div>
            `;
        }

        function saveSpecRepoConfig() {
            // Get the spec repo URL
            const specRepoUrl = document.getElementById('spec-repo-url').value;
            
            // Extract repo name from URL (e.g., "org/repo" from "https://github.com/org/repo.git")
            let repoName = specRepoUrl;
            if (specRepoUrl) {
                const match = specRepoUrl.match(/github\.com\/([^\/]+\/[^\/\.]+)/);
                if (match) {
                    repoName = match[1];
                } else {
                    // Try to extract from URL without .git extension
                    const parts = specRepoUrl.replace('.git', '').split('/');
                    if (parts.length >= 2) {
                        repoName = parts[parts.length - 2] + '/' + parts[parts.length - 1];
                    }
                }
            }
            
            // Show system message for repository configuration
            const chatMessages = document.getElementById('chat-messages');
            const repoConfigMessage = document.createElement('div');
            repoConfigMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            repoConfigMessage.innerHTML = `
                <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                    Spec repository selected
                </div>
            `;
            chatMessages.appendChild(repoConfigMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // After a brief delay, show ACP message about seeding
            setTimeout(() => {
                const seedPromptMessage = document.createElement('div');
                seedPromptMessage.className = 'message';
                seedPromptMessage.innerHTML = `
                    <div class="message-avatar ai-avatar">ACP</div>
                    <div class="message-content">
                        <div class="message-header">ACP</div>
                        <div id="seed-prompt-message"></div>
                        <div id="seed-button-container" style="opacity: 0; transition: opacity 0.3s ease-in; margin-top: 1rem;"></div>
                    </div>
                `;
                
                chatMessages.appendChild(seedPromptMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Type the seed prompt message
                const seedMessageElement = document.getElementById('seed-prompt-message');
                const seedMessageText = "Seed this repository to get started.";

                typeMessage(seedMessageElement, seedMessageText, 10, function() {
                    // Show Seed Repository button after typing completes
                    setTimeout(() => {
                        const seedButtonContainer = document.getElementById('seed-button-container');
                        if (seedButtonContainer) {
                            seedButtonContainer.innerHTML = `
                                <button onclick="seedRepositoryFromChat()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Seed Repository</button>
                            `;
                            
                            // Fade in the button
                            setTimeout(() => {
                                seedButtonContainer.style.opacity = '1';
                            }, 50);
                        }
                    }, 500);
                });
            }, 1000);

            // Update Spec Repository accordion only
            const specRepoAccordionContainer = document.getElementById('repository-details');

            if (specRepoAccordionContainer) {
                const accordionContent = `
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <strong style="color: #374151;">${repoName || 'Repository selected'}</strong>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #64748b; margin-bottom: 0.5rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                            </svg>
                            Seed this repository to get started.
                        </div>
                    </div>
                    <button onclick="seedRepositoryFromAccordion()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">Seed Repository</button>
                `;
                specRepoAccordionContainer.innerHTML = `
                    <div style="padding: 1rem;">
                        ${accordionContent}
                    </div>
                `;
            }
            
            // Close modal
            closeGitCredentialsModal();
            
            // Show repository details in the Spec Repository accordion
            const notConnectedMessage = document.querySelector('#spec-repository-content > div:first-child');
            
            if (specRepoAccordionContainer && notConnectedMessage) {
                notConnectedMessage.style.display = 'none';
                specRepoAccordionContainer.style.display = 'block';
            }
        }

        // Seed repository from chat button
        function seedRepositoryFromChat() {
            // Remove the seed button completely (keeping the message)
            const seedButtonContainer = document.getElementById('seed-button-container');
            if (seedButtonContainer) {
                seedButtonContainer.style.opacity = '0';
                setTimeout(() => {
                    seedButtonContainer.remove();
                }, 300);
            }

            // Call the regular seed function which will handle all the updates
            seedRepository();
        }

        // Seed repository from Spec Repository accordion
        function seedRepositoryFromAccordion() {
            const chatMessages = document.getElementById('chat-messages');
            const specRepoAccordionContainer = document.getElementById('repository-details');

            // Remove the seed button from chat if it exists
            const seedButtonContainer = document.getElementById('seed-button-container');
            if (seedButtonContainer) {
                seedButtonContainer.style.opacity = '0';
                setTimeout(() => {
                    seedButtonContainer.remove();
                }, 300);
            }

            // Get current repo name from accordion
            const repoNameElement = specRepoAccordionContainer ? specRepoAccordionContainer.querySelector('strong') : null;
            const repoName = repoNameElement ? repoNameElement.textContent : 'Repository selected';

            // Update to show seeding in progress in accordion
            const seedingContent = `
                <div style="padding: 1rem;">
                    <div style="margin-bottom: 0.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                            <strong style="color: #374151;">${repoName}</strong>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #64748b;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2" style="animation: spin 1s linear infinite;">
                                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                            </svg>
                            Seeding repository...
                        </div>
                    </div>
                </div>
            `;
            
            if (specRepoAccordionContainer) {
                specRepoAccordionContainer.innerHTML = seedingContent;
            }
            
            // After 3 seconds, show seeded state
            setTimeout(() => {
                // Show system message
                const seedCompleteMessage = document.createElement('div');
                seedCompleteMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
                seedCompleteMessage.innerHTML = `
                    <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                        Spec repository seeded
                    </div>
                `;
                chatMessages.appendChild(seedCompleteMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Mark repository as seeded
                isRepositorySeeded = true;

                // Enable the Agents accordion
                enableAgentsAccordion();

                // Enable workflow step buttons
                enableWorkflowSteps();

                // Hide repository requirement messages in workflows
                const rfeRepoRequirement = document.getElementById('rfe-repo-requirement');
                const specKitRepoRequirement = document.getElementById('spec-kit-repo-requirement');

                // Add helpful ACP message based on selected workflow
                setTimeout(function() {
                    const workflowType = selectedWorkflow;
                    let workflowMessage = '';

                    if (workflowType === 'create-rfe') {
                        workflowMessage = 'Great! Your spec repository is ready. You can now start planning your feature using the Plan a feature workflow. Try using /ideate to begin iterating on your idea, then move through /feasibility and /describe to create a comprehensive RFE.';
                    } else if (workflowType === 'create-feature') {
                        workflowMessage = 'Perfect! Your spec repository is set up. You\'re ready to start the Develop Feature workflow. Begin with /analyze to review existing specifications, use /clarify to identify areas needing more detail, then proceed through /specify, /plan, /tasks, and /implement.';
                    } else {
                        workflowMessage = 'Your spec repository is ready! Select a workflow from the dropdown above to get started with AI-assisted feature development.';
                    }

                    const helpfulMessage = document.createElement('div');
                    helpfulMessage.className = 'message';
                    helpfulMessage.innerHTML =
                        '<div class="message-avatar ai-avatar">AC</div>' +
                        '<div class="message-content">' +
                            '<div class="message-header">Ambient Code Platform</div>' +
                            '<div id="workflow-help-content"></div>' +
                        '</div>';

                    chatMessages.appendChild(helpfulMessage);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    updateMessageCount();

                    // Type out the message
                    typeMessage(document.getElementById('workflow-help-content'), workflowMessage, 15, function() {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    });
                }, 800);
                if (rfeRepoRequirement) {
                    rfeRepoRequirement.style.display = 'none';
                }
                if (specKitRepoRequirement) {
                    specKitRepoRequirement.style.display = 'none';
                }

                const seededContent = `
                    <div style="padding: 1rem;">
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                                <strong style="color: #374151;">${repoName}</strong>
                            </div>
                        </div>

                        <!-- File list -->
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.375rem; padding: 0.75rem; font-family: monospace; font-size: 0.75rem;">
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>.DS_Store</span>
                                <span>8.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>.claude/</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>.cursor/</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>.specify/</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>LICENSE</span>
                                <span>1.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>README.md</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>ascii-dan.txt</span>
                                <span>4.5K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>dist/</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>img/</span>
                                <span>0.0K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>index-minimal-site.html</span>
                                <span>3.7K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>index-scrolling-site.html</span>
                                <span>16.4K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;">
                                <span>video/</span>
                                <span>0.0K</span>
                            </div>
                        </div>
                    </div>
                `;
                
                if (specRepoAccordionContainer) {
                    specRepoAccordionContainer.innerHTML = seededContent;
                }
            }, 3000);
        }

        // Seed repository (called from Spec Repository accordion)
        function seedRepository() {
            // This function is no longer used from workflow accordion
            // Redirect to seedRepositoryFromAccordion
            seedRepositoryFromAccordion();
        }

        // Repository configuration functions
        function cancelRepositoryConfig() {
            // Close the accordion
            const repositoriesContent = document.getElementById('spec-repository-content');
            const repositoriesArrow = document.getElementById('spec-repository-arrow');
            
            if (repositoriesContent && repositoriesArrow) {
                repositoriesContent.style.display = 'none';
                repositoriesArrow.style.transform = 'rotate(0deg)';
            }
        }

        function saveRepositoryConfig() {
            // Here you would save the repository configuration
            // For now, just show a success message and close the accordion
            
            // Close the accordion
            const repositoriesContent = document.getElementById('spec-repository-content');
            const repositoriesArrow = document.getElementById('spec-repository-arrow');
            
            if (repositoriesContent && repositoriesArrow) {
                repositoriesContent.style.display = 'none';
                repositoriesArrow.style.transform = 'rotate(0deg)';
            }
            
            // Optional: Show success message in chat
            // You could add an ACP message here confirming the repository was configured
        }

        // Available commands
        const commands = ['help', 'ideate', 'specify', 'plan', 'tasks', 'implement'];

        // Handle chat input for commands/context/agents
        function handleChatInput(event) {
            const input = event.target;
            const value = input.value;
            const commandPopover = document.getElementById('command-popover');
            const agentPopover = document.getElementById('agent-popover');

            // Show agent popover when # is typed
            if (value === '#' || value.startsWith('#')) {
                commandPopover.style.display = 'none';

                var agentPopoverContent = document.getElementById('agent-popover-content');

                if (!isRepositorySeeded) {
                    // Show message that repository needs to be seeded
                    agentPopoverContent.innerHTML =
                        '<div style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">' +
                            'Add a seeded spec repository to this session to use agents.' +
                        '</div>';
                } else {
                    // Show agent list
                    var agents = [
                        { name: 'Archie', role: 'Architect' },
                        { name: 'Aria', role: 'UX Architect' },
                        { name: 'Casey', role: 'Content Strategist' },
                        { name: 'Dan', role: 'Senior Director' },
                        { name: 'Diego', role: 'Program Manager' },
                        { name: 'Emma', role: 'Engineering Manager' },
                        { name: 'Felix', role: 'UX Feature Lead' },
                        { name: 'Jack', role: 'Delivery Owner' },
                        { name: 'Lee', role: 'Team Lead' },
                        { name: 'Neil', role: 'Test Engineer' },
                        { name: 'Olivia', role: 'Product Owner' },
                        { name: 'Parker', role: 'Product Manager' },
                        { name: 'Phoenix', role: 'PXE Specialist' },
                        { name: 'Ryan', role: 'UX Researcher' },
                        { name: 'Sam', role: 'Scrum Master' },
                        { name: 'Stella', role: 'Staff Engineer' },
                        { name: 'Steve', role: 'UX Designer' },
                        { name: 'Taylor', role: 'Team Member' },
                        { name: 'Terry', role: 'Technical Writer' },
                        { name: 'Tessa', role: 'Writing Manager' },
                        { name: 'Uma', role: 'UX Team Lead' }
                    ];

                    var searchText = value.substring(1).toLowerCase();
                    var agentHtml = '';

                    for (var i = 0; i < agents.length; i++) {
                        var agent = agents[i];
                        var agentNameLower = agent.name.toLowerCase();

                        // Filter agents based on search text
                        if (searchText === '' || agentNameLower.indexOf(searchText) === 0) {
                            agentHtml +=
                                '<div onclick="selectAgent(\'' + agent.name + '\')" style="padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background=\'#f8fafc\'" onmouseout="this.style.background=\'white\'">' +
                                    '<div>' +
                                        '<div style="font-weight: 500; font-size: 0.875rem; color: #374151;">' + agent.name + '</div>' +
                                        '<div style="font-size: 0.75rem; color: #64748b;">' + agent.role + '</div>' +
                                    '</div>' +
                                '</div>';
                        }
                    }

                    if (agentHtml === '') {
                        agentHtml = '<div style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">No agents found</div>';
                    }

                    agentPopoverContent.innerHTML = agentHtml;
                }

                agentPopover.style.display = 'block';
                return;
            } else {
                agentPopover.style.display = 'none';
            }

            // Show command popover when / is typed
            if (value === '/' || value.startsWith('/')) {
                // Get the text after the slash
                const searchText = value.substring(1).toLowerCase();

                // Determine which commands should be available based on workflow
                var availableCommands = ['help']; // help is always available

                if (selectedWorkflow === 'create-rfe') {
                    availableCommands.push('ideate', 'feasibility', 'describe');
                } else if (selectedWorkflow === 'create-feature') {
                    availableCommands.push('analyze', 'clarify', 'specify', 'plan', 'tasks', 'implement');
                }

                // Filter and show matching commands
                const commandItems = commandPopover.querySelectorAll('div[onclick^="selectCommand"]');
                let visibleCount = 0;

                commandItems.forEach(function(item) {
                    const onclickAttr = item.getAttribute('onclick');
                    if (!onclickAttr) return;

                    const match = onclickAttr.match(/'([^']+)'/);
                    if (!match) return;

                    const commandName = match[1];

                    // Check if command is available for current workflow and matches search
                    if (availableCommands.indexOf(commandName) !== -1 && commandName.startsWith(searchText)) {
                        item.style.display = 'flex';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Handle the no-workflow message visibility
                var noWorkflowMessage = document.getElementById('no-workflow-message');
                if (noWorkflowMessage) {
                    if (!selectedWorkflow || selectedWorkflow === 'default') {
                        noWorkflowMessage.style.display = 'block';
                    } else {
                        noWorkflowMessage.style.display = 'none';
                    }
                }

                // Show popover if there are matching commands or the no-workflow message
                if (visibleCount > 0 || (!selectedWorkflow || selectedWorkflow === 'default')) {
                    commandPopover.style.display = 'block';
                } else {
                    commandPopover.style.display = 'none';
                }
            } else {
                commandPopover.style.display = 'none';
            }

            // Show context popover when @ is typed
            const contextPopover = document.getElementById('context-popover');
            if (value === '@' || value.startsWith('@')) {
                commandPopover.style.display = 'none';
                agentPopover.style.display = 'none';

                var contextPopoverContent = document.getElementById('context-popover-content');

                // Check if spec repo has been added
                var repoDetails = document.getElementById('repository-details');
                var hasSpecRepo = repoDetails && repoDetails.style.display !== 'none';

                if (!hasSpecRepo) {
                    // Show message that spec repo needs to be added
                    contextPopoverContent.innerHTML =
                        '<div style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">' +
                            'Add a spec repo to add files to the workspace.' +
                        '</div>';
                } else {
                    // Get all files from the spec repo file list
                    var fileListContainer = document.querySelector('#repository-details div[style*="background: #f8fafc"]');
                    var files = [];

                    if (fileListContainer) {
                        var fileEntries = fileListContainer.querySelectorAll('div[style*="display: flex"]');
                        fileEntries.forEach(function(entry) {
                            var filenameElement = entry.querySelector('span');
                            if (filenameElement) {
                                var filename = filenameElement.textContent.trim();
                                // Only add markdown and text files
                                if (filename.endsWith('.md') || filename.endsWith('.txt')) {
                                    files.push(filename);
                                }
                            }
                        });
                    }

                    var searchText = value.substring(1).toLowerCase();
                    var fileHtml = '';

                    if (files.length === 0) {
                        fileHtml = '<div style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">No files available for context</div>';
                    } else {
                        for (var i = 0; i < files.length; i++) {
                            var filename = files[i];
                            var filenameLower = filename.toLowerCase();

                            // Filter files based on search text
                            if (searchText === '' || filenameLower.indexOf(searchText) === 0) {
                                fileHtml +=
                                    '<div onclick="selectContext(\'' + filename + '\')" style="padding: 0.75rem; cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 0.75rem; border-bottom: 1px solid #e2e8f0;" onmouseover="this.style.background=\'#f8fafc\'" onmouseout="this.style.background=\'white\'">' +
                                        '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">' +
                                            '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                            '<polyline points="14 2 14 8 20 8"/>' +
                                        '</svg>' +
                                        '<div style="font-weight: 500; font-size: 0.875rem; color: #374151;">' + filename + '</div>' +
                                    '</div>';
                            }
                        }

                        if (fileHtml === '') {
                            fileHtml = '<div style="padding: 1rem; text-align: center; color: #64748b; font-size: 0.875rem;">No files found</div>';
                        }
                    }

                    contextPopoverContent.innerHTML = fileHtml;
                }

                contextPopover.style.display = 'block';
                return;
            } else {
                contextPopover.style.display = 'none';
            }
        }

        // Select a command from the popover
        function selectCommand(command) {
            const input = document.getElementById('chat-input-field');
            const commandPopover = document.getElementById('command-popover');

            // Set the input value to the command
            input.value = '/' + command + ' ';
            commandPopover.style.display = 'none';

            // Focus back on input
            input.focus();
        }

        // Select an agent from the popover
        function selectAgent(agentName) {
            const input = document.getElementById('chat-input-field');
            const agentPopover = document.getElementById('agent-popover');

            // Set the input value to the agent name
            input.value = '#' + agentName + ' ';
            agentPopover.style.display = 'none';

            // Focus back on input
            input.focus();
        }

        // Select a context file from the popover
        function selectContext(filename) {
            const input = document.getElementById('chat-input-field');
            const contextPopover = document.getElementById('context-popover');

            // Set the input value to the filename
            input.value = '@' + filename + ' ';
            contextPopover.style.display = 'none';

            // Focus back on input
            input.focus();
        }

        // Close popovers when clicking outside
        document.addEventListener('click', function(event) {
            const commandPopover = document.getElementById('command-popover');
            const agentPopover = document.getElementById('agent-popover');
            const contextPopover = document.getElementById('context-popover');
            const chatInput = document.getElementById('chat-input-field');

            // Don't close if clicking on the input field itself
            if (event.target === chatInput) {
                return;
            }

            if (commandPopover && chatInput &&
                !commandPopover.contains(event.target)) {
                commandPopover.style.display = 'none';
            }

            if (agentPopover && chatInput &&
                !agentPopover.contains(event.target)) {
                agentPopover.style.display = 'none';
            }

            if (contextPopover && chatInput &&
                !contextPopover.contains(event.target)) {
                contextPopover.style.display = 'none';
            }
        });

        // Initialize welcome message on page load
        window.addEventListener('DOMContentLoaded', function() {
            const welcomeElement = document.getElementById('welcome-message');
            const welcomeText = "Welcome to the Ambient Code Platform. I'm here to help you with coding tasks, answer questions, and collaborate on your project. Use the /help command at any time for guidance. Type your message below or select a workflow to get started.";
            
            if (welcomeElement) {
                setTimeout(() => {
                    typeMessage(welcomeElement, welcomeText, 10, function() {
                        // Show workflow cards after typing completes
                        setTimeout(() => {
                            showWorkflowCards();
                        }, 300);
                    });
                }, 300);
            }
        });

        // Close dropdown when clicking outside of it
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.user-dropdown');
            if (!dropdown.contains(event.target)) {
                document.getElementById('userDropdownMenu').style.display = 'none';
                document.getElementById('user-dropdown-arrow').style.transform = 'rotate(0deg)';
            }
        });

        // Run /ideate command
        function runIdeateCommand() {
            const chatMessages = document.getElementById('chat-messages');

            // Update the workflow step to show spinner and status
            const workflowStepFilename = document.querySelector('#rfe-phases .workflow-step-filename');
            if (workflowStepFilename) {
                workflowStepFilename.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; display: inline; vertical-align: middle; margin-right: 0.25rem;">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                    creating idea.md...
                `;
            }

            // Get selected agents
            const selectedAgents = [];
            const agentCheckboxes = document.querySelectorAll('#agents-list input[type="checkbox"]:not(#dynamic-agent-selection)');
            agentCheckboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    const label = checkbox.parentElement.querySelector('span');
                    const agentText = label.textContent;
                    const agentName = agentText.split(' - ')[0];
                    const agentRole = agentText.split(' - ')[1];
                    selectedAgents.push({ name: agentName, role: agentRole });
                }
            });

            // Always add UX Researcher (Ryan) and Content Strategist (Casey) if not already selected
            const hasRyan = selectedAgents.some(agent => agent.name === 'Ryan');
            const hasCasey = selectedAgents.some(agent => agent.name === 'Casey');

            if (!hasRyan) {
                selectedAgents.unshift({ name: 'Ryan', role: 'UX Researcher' });
            }
            if (!hasCasey) {
                selectedAgents.unshift({ name: 'Casey', role: 'Content Strategist' });
            }

            // Show system message about collaboration
            const systemMessage = document.createElement('div');
            systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            systemMessage.innerHTML = `
                <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                    Selected agents are collaborating on an idea.md file based on the associated repositories and provided context.
                </div>
            `;

            chatMessages.appendChild(systemMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Show agent contributions if there are selected agents
            if (selectedAgents.length > 0) {
                showAgentContributions(selectedAgents, 0, () => {
                    // After all agents have contributed, show RFE content
                    showRFEContent();
                });
            } else {
                // No agents selected, just show RFE content
                setTimeout(() => {
                    showRFEContent();
                }, 500);
            }
        }

        // Show agent contributions one by one
        function showAgentContributions(agents, index, callback) {
            if (index >= agents.length) {
                callback();
                return;
            }

            const agent = agents[index];
            const chatMessages = document.getElementById('chat-messages');

            setTimeout(function() {
                const agentMessage = document.createElement('div');
                agentMessage.className = 'message';
                agentMessage.innerHTML =
                    '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">' + agent.name.substring(0, 2).toUpperCase() + '</div>' +
                    '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                        '<div class="message-header">' + agent.name + ' (' + agent.role + ')</div>' +
                        '<div id="agent-' + index + '-message"></div>' +
                    '</div>';

                chatMessages.appendChild(agentMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Update message count
                updateMessageCount();

                // Type out agent's contribution
                const messageElement = document.getElementById('agent-' + index + '-message');
                const contributions = {
                    'Archie': 'I will focus on the system architecture and technical patterns for the dashboard redesign.',
                    'Aria': 'I will design the user experience strategy and journey mapping for AI platform engineers.',
                    'Parker': 'I will ensure the redesign aligns with market strategy and delivers business value.',
                    'Uma': 'I will oversee the design quality and maintain consistency with our design system.',
                    'Felix': 'I will work on component design and accessibility implementation for the new interface.',
                    'Steve': 'I will create visual designs and prototypes for the proposed directions.',
                    'Ryan': 'I will analyze user insights and validate design decisions with research data.',
                    'Olivia': 'I will define acceptance criteria and prioritize features for the sprint.',
                    'Emma': 'I will coordinate the team and ensure we balance technical excellence with delivery timelines.',
                    'Lee': 'I will facilitate sprint planning and coordinate cross-team dependencies.',
                    'Taylor': 'I will focus on pragmatic implementation and code quality for the frontend.',
                    'Stella': 'I will provide technical leadership and bridge the architecture to implementation.',
                    'Diego': 'I will manage the documentation roadmap and content strategy.',
                    'Terry': 'I will create user-centered documentation for the new dashboard features.',
                    'Tessa': 'I will coordinate documentation standards and content quality.',
                    'Casey': 'I will develop the information architecture and content taxonomy.',
                    'Dan': 'I will validate strategic alignment with company growth pillars.',
                    'Sam': 'I will facilitate the agile process and remove impediments.',
                    'Jack': 'I will track cross-team dependencies and manage delivery milestones.',
                    'Phoenix': 'I will assess customer impact and plan for smooth upgrade paths.',
                    'Neil': 'I will ensure testability and verify implementation matches requirements.'
                };

                const contribution = contributions[agent.name] || 'I will contribute my expertise as ' + agent.role + ' to this RFE.';

                typeMessage(messageElement, contribution, 10, function() {
                    // Move to next agent
                    showAgentContributions(agents, index + 1, callback);
                });
            }, 300);
        }

        // Show RFE content
        function showRFEContent() {
            const chatMessages = document.getElementById('chat-messages');

            const rfeMessage = document.createElement('div');
            rfeMessage.className = 'message';
            rfeMessage.innerHTML =
                '<div class="message-avatar ai-avatar">AC</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">Ambient Code Platform</div>' +
                    '<div style="margin-top: 0.5rem;">' +
                        '<div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; padding: 0.5rem; background: #f8fafc; border-radius: 0.375rem;">' +
                            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                            '</svg>' +
                            '<strong>idea.md</strong>' +
                        '</div>' +
                        '<div id="rfe-content" style="background: #f8fafc; padding: 1rem; border-radius: 0.375rem; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></div>' +
                    '</div>' +
                    '<div id="rfe-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem;"></div>' +
                '</div>';

            chatMessages.appendChild(rfeMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Update message count
            updateMessageCount();

            // Type out the idea content
            const rfeContentElement = document.getElementById('rfe-content');
            var rfeContent = '# Idea: Enhanced Model Discovery for AI Platform Engineers\n\n' +
'## Overview\n\n' +
'AI Platform Engineers like Paula struggle to efficiently find and evaluate production-ready AI models from thousands of options. The current dashboard presents models in a traditional format that doesn\'t optimize for AI-centric workflows.\n\n' +
'This idea proposes reimagining the model discovery experience to make it more visual, intelligent, and task-oriented.\n\n' +
'## The Problem\n\n' +
'Paula, an AI Platform Engineer, needs to:\n' +
'- Search through thousands of AI models quickly\n' +
'- Compare performance metrics (latency, throughput, accuracy)\n' +
'- Understand compatibility with existing infrastructure\n' +
'- Evaluate deployment costs and requirements\n\n' +
'Current challenges:\n' +
'- **Information overload**: Too many models without effective filtering\n' +
'- **Limited comparison**: No easy way to compare models side-by-side\n' +
'- **Hidden insights**: Performance data buried in text rather than visualized\n' +
'- **Fragmented workflow**: Constant switching between catalog, registry, and deployment views\n\n' +
'## The Opportunity\n\n' +
'Transform the dashboard from a traditional enterprise interface into an intelligent visual workspace that:\n\n' +
'1. **Visualizes the model landscape** - Show models as an interactive visual map, clustered by use case, provider, and performance\n\n' +
'2. **Makes filtering intuitive** - Replace checkboxes with visual sliders and real-time feedback showing how filters affect the available options\n\n' +
'3. **Enables smart recommendations** - Use AI to suggest models based on requirements, with confidence scores and reasoning\n\n' +
'4. **Simplifies comparison** - Allow side-by-side comparison with interactive charts and compatibility matrices\n\n' +
'5. **Integrates workflows** - Provide drag-and-drop connections to MCP servers and agents\n\n' +
'## Success Would Look Like\n\n' +
'- Paula finds relevant models 60% faster\n' +
'- Reduced cognitive load when evaluating options\n' +
'- Higher confidence in deployment decisions\n' +
'- Improved satisfaction with the discovery process\n\n' +
'## Key Questions to Explore\n\n' +
'- What\'s the right balance between visual richness and performance with thousands of models?\n' +
'- How can we make AI recommendations transparent and trustworthy?\n' +
'- What level of customization do users need for their workflows?\n' +
'- How do we maintain accessibility while adding visual features?\n\n' +
'## Next Steps\n\n' +
'1. Validate the problem with user research\n' +
'2. Assess technical feasibility of visualization approaches\n' +
'3. Prototype key interaction patterns\n' +
'4. Define success metrics and measurement strategy';

            typeMessage(rfeContentElement, rfeContent, 5, function() {
                // Scroll to bottom after typing completes
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Restore the workflow step description
                const workflowStepFilename = document.querySelector('#rfe-phases .workflow-step-filename');
                if (workflowStepFilename) {
                    workflowStepFilename.innerHTML = 'Iterate your idea';
                }

                // Show action buttons
                const actionsDiv = document.getElementById('rfe-actions');
                if (actionsDiv) {
                    actionsDiv.style.display = 'flex';
                    actionsDiv.innerHTML =
                        '<button onclick="copyRFEContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>' +
                                '<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>' +
                            '</svg>' +
                            'Copy' +
                        '</button>' +
                        '<button onclick="downloadIdeaMd()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>' +
                                '<polyline points="7 10 12 15 17 10"/>' +
                                '<line x1="12" y1="15" x2="12" y2="3"/>' +
                            '</svg>' +
                            'Download' +
                        '</button>' +
                        '<button onclick="openIdeaInVSCode()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>' +
                            '</svg>' +
                            'Open in VS Code' +
                        '</button>' +
                        '<button onclick="openIdeaInGoogleDocs()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                                '<line x1="16" y1="13" x2="8" y2="13"/>' +
                                '<line x1="16" y1="17" x2="8" y2="17"/>' +
                                '<line x1="10" y1="9" x2="8" y2="9"/>' +
                            '</svg>' +
                            'Open in Google Docs' +
                        '</button>' +
                        '<button onclick="viewRFEContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>' +
                                '<circle cx="12" cy="12" r="3"/>' +
                            '</svg>' +
                            'View' +
                        '</button>';
                }

                // Add result to Results accordion
                addResultToAccordion('idea.md was created');

                // Add file to repository file list
                addFileToRepository('idea.md', '12.3K');

                // Enable the Feasibility step now that idea.md is created
                enableFeasibilityStep();
            });
        }

        // Enable the Feasibility workflow step
        function enableFeasibilityStep() {
            const feasibilityStep = document.getElementById('feasibility-step');
            const feasibilityButton = document.getElementById('feasibility-button');

            if (feasibilityStep) {
                // Update step styling to show it's unlocked
                feasibilityStep.style.background = 'white';
                feasibilityStep.style.opacity = '1';

                // Update icon from lock to magnifying glass
                const icon = feasibilityStep.querySelector('span');
                if (icon) {
                    icon.textContent = 'üîç';
                }

                // Update description
                const filename = feasibilityStep.querySelector('.workflow-step-filename');
                if (filename) {
                    filename.textContent = 'Assess technical feasibility';
                }

                // Enable the button
                if (feasibilityButton) {
                    feasibilityButton.removeAttribute('disabled');
                    feasibilityButton.style.opacity = '1';
                    feasibilityButton.style.cursor = 'pointer';
                    feasibilityButton.title = 'Run the /feasibility command';
                }
            }
        }

        // Run Feasibility command
        function runFeasibilityCommand() {
            const chatMessages = document.getElementById('chat-messages');

            // Update the workflow step to show spinner and status
            const workflowStepFilename = document.querySelector('#feasibility-step .workflow-step-filename');
            if (workflowStepFilename) {
                workflowStepFilename.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; display: inline; vertical-align: middle; margin-right: 0.25rem;">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                    assessing feasibility...
                `;
            }

            // Show system message about feasibility assessment
            const systemMessage = document.createElement('div');
            systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            systemMessage.innerHTML = `
                <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                    Architect and Senior Engineer are assessing technical feasibility based on idea.md
                </div>
            `;

            chatMessages.appendChild(systemMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Bring in Architect (Archie) first
            setTimeout(function() {
                const archieMessage = document.createElement('div');
                archieMessage.className = 'message';
                archieMessage.innerHTML =
                    '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">AR</div>' +
                    '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                        '<div class="message-header">Archie (Architect)</div>' +
                        '<div id="archie-feasibility-message"></div>' +
                    '</div>';

                chatMessages.appendChild(archieMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                updateMessageCount();

                const archieStatus = "I'm reviewing the idea.md file from an architectural perspective. I'll be evaluating system design patterns, scalability considerations, and integration points with existing systems. This will help us understand the architectural complexity and identify any potential technical constraints.";

                typeMessage(document.getElementById('archie-feasibility-message'), archieStatus, 10, function() {
                    chatMessages.scrollTop = chatMessages.scrollHeight;

                    // Bring in Senior Engineer (Stella) after Archie
                    setTimeout(function() {
                        const stellaMessage = document.createElement('div');
                        stellaMessage.className = 'message';
                        stellaMessage.innerHTML =
                            '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">ST</div>' +
                            '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                                '<div class="message-header">Stella (Senior Engineer)</div>' +
                                '<div id="stella-feasibility-message"></div>' +
                            '</div>';

                        chatMessages.appendChild(stellaMessage);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        updateMessageCount();

                        const stellaStatus = "I'm analyzing the idea.md from an implementation standpoint. I'll assess the technical complexity, development effort, performance implications, and potential risks. I'll also consider existing code patterns and libraries we can leverage to accelerate delivery.";

                        typeMessage(document.getElementById('stella-feasibility-message'), stellaStatus, 10, function() {
                            chatMessages.scrollTop = chatMessages.scrollHeight;

                            // Update workflow step description
                            if (workflowStepFilename) {
                                workflowStepFilename.innerHTML = `
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; display: inline; vertical-align: middle; margin-right: 0.25rem;">
                                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                                    </svg>
                                    creating feasibility.md...
                                `;
                            }

                            // Generate feasibility.md document after a brief pause
                            setTimeout(function() {
                                showFeasibilityDocument();
                            }, 1500);
                        });
                    }, 1500);
                });
            }, 800);
        }

        // Show the feasibility.md document
        function showFeasibilityDocument() {
            const chatMessages = document.getElementById('chat-messages');

            // Create feasibility.md content display
            const feasibilityDoc = document.createElement('div');
            feasibilityDoc.className = 'message';
            feasibilityDoc.innerHTML =
                '<div class="message-avatar ai-avatar">AC</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">Ambient Code Platform</div>' +
                    '<div style="margin-top: 0.5rem;">' +
                        '<div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; padding: 0.5rem; background: #f8fafc; border-radius: 0.375rem;">' +
                            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                            '</svg>' +
                            '<strong>feasibility.md</strong>' +
                        '</div>' +
                        '<div id="feasibility-content" style="background: #f8fafc; padding: 1rem; border-radius: 0.375rem; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></div>' +
                    '</div>' +
                    '<div id="feasibility-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem;"></div>' +
                '</div>';

            chatMessages.appendChild(feasibilityDoc);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Update message count
            updateMessageCount();

            // Generate feasibility document content
            const feasibilityContent = `# Technical Feasibility Assessment

## Executive Summary
This document provides a comprehensive technical feasibility analysis for the proposed feature described in idea.md. The assessment was conducted by the Architecture and Engineering teams to evaluate technical viability, complexity, and implementation considerations.

## Architectural Evaluation
**Assessed by: Archie (Architect)**

### System Design Patterns
- The proposed solution aligns well with our existing microservices architecture
- Recommend implementing using event-driven patterns for scalability
- Integration points with existing systems are well-defined and manageable

### Scalability Considerations
- Horizontal scaling is feasible with current infrastructure
- Database sharding may be required for high-volume scenarios
- Caching strategy recommended for optimal performance

### Technical Constraints
- No major architectural blockers identified
- Existing API contracts can accommodate the new feature
- Minor refactoring may be needed in authentication layer

## Implementation Analysis
**Assessed by: Stella (Senior Engineer)**

### Technical Complexity
- Overall complexity: **Medium**
- Core functionality can leverage existing libraries and frameworks
- Estimated development effort: 3-4 sprint cycles

### Development Effort Breakdown
- Backend API development: 40%
- Frontend implementation: 30%
- Testing and integration: 20%
- Documentation and deployment: 10%

### Performance Implications
- Expected latency: <200ms for standard operations
- Resource requirements align with current infrastructure capacity
- No significant performance concerns identified

### Risk Assessment
**Low Risk Factors:**
- Well-understood technology stack
- Clear integration boundaries
- Strong team expertise in required areas

**Medium Risk Factors:**
- Third-party API dependencies (mitigation: implement fallback mechanisms)
- Data migration complexity (mitigation: phased rollout approach)

### Recommendations
1. Leverage existing component libraries to accelerate development
2. Implement feature flags for gradual rollout
3. Plan for comprehensive integration testing
4. Consider A/B testing framework for validation

## Technical Dependencies
- No new infrastructure required
- Existing CI/CD pipeline is sufficient
- Current monitoring and logging systems adequate

## Conclusion
**Feasibility Rating: ‚úÖ FEASIBLE**

The proposed feature is technically feasible with manageable complexity and acceptable risk levels. The team has the necessary expertise and infrastructure to implement this successfully. Recommend proceeding to detailed specification phase.

---
*Generated by Ambient Code Platform - Feasibility Assessment*
*Contributors: Archie (Architect), Stella (Senior Engineer)*`;

            // Type out the feasibility document
            const contentElement = document.getElementById('feasibility-content');
            typeMessage(contentElement, feasibilityContent, 5, function() {
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Restore the workflow step description
                const workflowStepFilename = document.querySelector('#feasibility-step .workflow-step-filename');
                if (workflowStepFilename) {
                    workflowStepFilename.innerHTML = 'Assess technical feasibility';
                }

                // Show action buttons
                const actionsDiv = document.getElementById('feasibility-actions');
                if (actionsDiv) {
                    actionsDiv.innerHTML =
                        '<button onclick="copyFeasibilityContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>' +
                                '<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>' +
                            '</svg>' +
                            'Copy' +
                        '</button>' +
                        '<button onclick="downloadFeasibilityMd()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>' +
                                '<polyline points="7 10 12 15 17 10"/>' +
                                '<line x1="12" y1="15" x2="12" y2="3"/>' +
                            '</svg>' +
                            'Download' +
                        '</button>' +
                        '<button onclick="openFeasibilityInVSCode()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>' +
                            '</svg>' +
                            'Open in VS Code' +
                        '</button>' +
                        '<button onclick="openFeasibilityInGoogleDocs()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                                '<line x1="16" y1="13" x2="8" y2="13"/>' +
                                '<line x1="16" y1="17" x2="8" y2="17"/>' +
                                '<line x1="10" y1="9" x2="8" y2="9"/>' +
                            '</svg>' +
                            'Open in Google Docs' +
                        '</button>' +
                        '<button onclick="viewFeasibilityContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>' +
                                '<circle cx="12" cy="12" r="3"/>' +
                            '</svg>' +
                            'View' +
                        '</button>';
                }

                // Add result to Results accordion
                addResultToAccordion('feasibility.md was created');

                // Add file to repository file list
                addFileToRepository('feasibility.md', '8.7K');

                // Enable the Describe step now that feasibility is complete
                enableDescribeStep();
            });
        }

        // Enable the Describe workflow step
        function enableDescribeStep() {
            const describeStep = document.getElementById('describe-step');
            const describeButton = document.getElementById('describe-button');

            if (describeStep) {
                // Update step styling to show it's unlocked
                describeStep.style.background = 'white';
                describeStep.style.opacity = '1';

                // Update icon from lock to pencil
                const icon = describeStep.querySelector('span');
                if (icon) {
                    icon.textContent = 'üìù';
                }

                // Update description
                const filename = describeStep.querySelector('.workflow-step-filename');
                if (filename) {
                    filename.textContent = 'Create detailed specification';
                }

                // Enable the button
                if (describeButton) {
                    describeButton.removeAttribute('disabled');
                    describeButton.style.opacity = '1';
                    describeButton.style.cursor = 'pointer';
                    describeButton.title = 'Run the /describe command';
                }
            }
        }

        // Run Describe command
        function runDescribeCommand() {
            const chatMessages = document.getElementById('chat-messages');

            // Update the workflow step to show spinner and status
            const workflowStepFilename = document.querySelector('#describe-step .workflow-step-filename');
            if (workflowStepFilename) {
                workflowStepFilename.innerHTML = `
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; display: inline; vertical-align: middle; margin-right: 0.25rem;">
                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                    </svg>
                    authoring rfe.md...
                `;
            }

            // Show system message about authoring rfe.md
            const systemMessage = document.createElement('div');
            systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            systemMessage.innerHTML = `
                <div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">
                    Product Manager and Architect are authoring rfe.md based on idea.md and feasibility.md
                </div>
            `;

            chatMessages.appendChild(systemMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Bring in Product Manager (Parker) first
            setTimeout(function() {
                const parkerMessage = document.createElement('div');
                parkerMessage.className = 'message';
                parkerMessage.innerHTML =
                    '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">PA</div>' +
                    '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                        '<div class="message-header">Parker (Product Manager)</div>' +
                        '<div id="parker-describe-message"></div>' +
                    '</div>';

                chatMessages.appendChild(parkerMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                updateMessageCount();

                const parkerStatus = "I'm authoring the rfe.md document from a product perspective. I'll incorporate the original idea, business value, user stories, and align it with our product roadmap and strategic goals. The feasibility assessment will help me set realistic expectations and prioritize features.";

                typeMessage(document.getElementById('parker-describe-message'), parkerStatus, 10, function() {
                    chatMessages.scrollTop = chatMessages.scrollHeight;

                    // Bring in Architect (Archie) after Parker
                    setTimeout(function() {
                        const archieMessage = document.createElement('div');
                        archieMessage.className = 'message';
                        archieMessage.innerHTML =
                            '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">AR</div>' +
                            '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                                '<div class="message-header">Archie (Architect)</div>' +
                                '<div id="archie-describe-message"></div>' +
                            '</div>';

                        chatMessages.appendChild(archieMessage);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        updateMessageCount();

                        const archieStatus = "I'm contributing the technical architecture section to the rfe.md. I'll define the system design, integration patterns, data flows, and technical requirements based on the feasibility findings. This will provide clear technical guidance for the implementation team.";

                        typeMessage(document.getElementById('archie-describe-message'), archieStatus, 10, function() {
                            chatMessages.scrollTop = chatMessages.scrollHeight;

                            // Update workflow step description
                            if (workflowStepFilename) {
                                workflowStepFilename.innerHTML = `
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite; display: inline; vertical-align: middle; margin-right: 0.25rem;">
                                        <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                                    </svg>
                                    creating rfe.md...
                                `;
                            }

                            // Generate rfe.md document after a brief pause
                            setTimeout(function() {
                                showRFEDocument();
                            }, 1500);
                        });
                    }, 1500);
                });
            }, 800);
        }

        // Show the rfe.md document
        function showRFEDocument() {
            const chatMessages = document.getElementById('chat-messages');

            // Create rfe.md content display
            const rfeDoc = document.createElement('div');
            rfeDoc.className = 'message';
            rfeDoc.innerHTML =
                '<div class="message-avatar ai-avatar">AC</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">Ambient Code Platform</div>' +
                    '<div style="margin-top: 0.5rem;">' +
                        '<div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; padding: 0.5rem; background: #f8fafc; border-radius: 0.375rem;">' +
                            '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                            '</svg>' +
                            '<strong>rfe.md</strong>' +
                        '</div>' +
                        '<div id="rfe-doc-content" style="background: #f8fafc; padding: 1rem; border-radius: 0.375rem; font-family: monospace; font-size: 0.875rem; white-space: pre-wrap; max-height: 400px; overflow-y: auto;"></div>' +
                    '</div>' +
                    '<div id="rfe-doc-actions" style="margin-top: 1rem; display: flex; gap: 0.5rem;"></div>' +
                '</div>';

            chatMessages.appendChild(rfeDoc);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Update message count
            updateMessageCount();

            // Generate RFE document content
            const rfeDocContent = `# Request for Enhancement (RFE)

## Enhanced Model Discovery for AI Platform Engineers

---

### General Guidance
This RFE is well-scoped and focused on improving the model discovery experience for AI Platform Engineers. It addresses a specific user pain point while remaining flexible in implementation approach to allow the RFE council to provide guidance on the optimal solution.

**Guiding Principles Applied:**
- ‚úì Smaller, focused scope on model discovery enhancement
- ‚úì Not overly prescriptive - presents problem and high-level solution direction
- ‚úì Well-defined domain - AI model catalog and discovery workflows

---

## Problem Statement

AI Platform Engineers like Paula face significant challenges when searching for and evaluating production-ready AI models from extensive catalogs containing thousands of options. The current model discovery interface presents several pain points:

**Current State Challenges:**
1. **Overwhelming Volume**: Engineers must manually scan through thousands of models to find candidates suitable for their specific use case
2. **Limited Filtering**: Existing search only supports basic text-based queries, lacking advanced filtering by performance metrics, hardware requirements, or use case categories
3. **No Visual Comparison**: Engineers cannot easily compare key metrics (latency, throughput, accuracy, cost) across multiple models side-by-side
4. **Inefficient Workflow**: The process of discovery ‚Üí evaluation ‚Üí selection ‚Üí deployment requires navigating multiple disconnected screens and tools
5. **Missing Context**: Models are presented without contextual information about real-world performance, similar model comparisons, or recommended use cases

**User Impact:**
- Platform engineers spend 3-5 hours on average finding the right model for a new project
- 40% of model selections result in suboptimal performance, requiring engineers to restart the discovery process
- Lack of confidence in model selection leads to delayed project timelines

**Current Workflow Diagram:**
\`\`\`
Browse catalog ‚Üí Search by keyword ‚Üí Open model details (new page) ‚Üí
Check metrics individually ‚Üí Copy to spreadsheet for comparison ‚Üí
Repeat 10-15 times ‚Üí Make selection ‚Üí Discover incompatibility ‚Üí Restart
\`\`\`

---

## Business Alignment

### 1. Business Value and Impact

**Expected Impact:**
- **Customer Reach**: 500+ AI Platform Engineers currently using the platform, with 2,000+ potential users in pipeline
- **Time Savings**: Reduce model discovery time from 3-5 hours to 30-45 minutes (75% reduction)
- **Revenue Opportunity**: Improved experience expected to increase platform adoption by 25%, translating to $1.2M ARR growth
- **Customer Satisfaction**: Address #1 feature request from enterprise customers (mentioned in 80% of customer interviews)

**Market Opportunity:**
- AI/ML platform market growing at 38% CAGR
- Competitors lack sophisticated model discovery features
- Early advantage in this space can establish market leadership
- 3 enterprise deals ($500K+ each) currently delayed pending this enhancement

### 2. Red Hat AI Outcome Alignment

This enhancement aligns with the **"Accelerate AI Developer Productivity"** outcome by:
- Reducing friction in the AI development workflow
- Empowering engineers to make faster, more informed decisions
- Improving overall platform efficiency and user satisfaction
- Supporting enterprise AI adoption at scale

---

## Proposed Solution/Rationale

**High-Level Approach:**
Transform the model discovery experience from a traditional text-based catalog into an intelligent, visual, and task-oriented discovery interface that helps engineers quickly find optimal models for their specific requirements.

**Key Capabilities:**

1. **Smart Filtering & Search**
   - Multi-dimensional filtering (use case, performance tier, hardware compatibility, license type)
   - Natural language search with intent detection
   - Saved search queries and filter presets

2. **Visual Model Comparison**
   - Side-by-side comparison view (up to 5 models)
   - Interactive performance charts (latency, throughput, accuracy trade-offs)
   - Cost estimation based on expected usage patterns

3. **Contextual Recommendations**
   - "Similar models" suggestions based on current selection
   - Use-case-specific model recommendations
   - Community ratings and production deployment statistics

4. **Streamlined Workflow**
   - Single-page application with embedded model details
   - Quick-deploy actions directly from discovery interface
   - Integration with deployment pipeline

**User Scenarios:**

**Scenario 1 - New Project Model Selection:**
Paula needs to find a text classification model for a customer support automation project. She enters "customer support classification" in natural language search, filters by "production-ready" and "latency < 100ms", compares top 3 candidates visually, reviews community feedback, and deploys directly from the comparison view. Total time: 25 minutes.

**Scenario 2 - Model Upgrade:**
Paula's current sentiment analysis model is underperforming. She uses "Find similar models" on her existing deployment, filters for "higher accuracy" while maintaining similar latency, compares upgrade candidates side-by-side with current model performance, and makes data-driven upgrade decision. Total time: 15 minutes.

**Assumptions:**
- Model catalog metadata includes standardized performance benchmarks
- Models have consistent tagging and categorization
- Backend API can support complex filtering queries with acceptable performance
- Users have basic familiarity with ML concepts and metrics

---

## Acceptance Criteria

**Success is defined by:**

1. **Functional Requirements**
   - ‚úì Users can filter models by at least 5 dimensions (use case, performance, hardware, framework, license)
   - ‚úì Side-by-side comparison supports 3-5 models simultaneously
   - ‚úì Visual charts display latency, throughput, accuracy, and cost metrics
   - ‚úì Natural language search returns relevant results with >80% accuracy
   - ‚úì Users can save searches and create custom filter presets
   - ‚úì Integration with deployment pipeline allows one-click deployment from discovery UI

2. **Performance Requirements**
   - ‚úì Search and filter operations return results in <2 seconds
   - ‚úì Comparison view loads all model data in <3 seconds
   - ‚úì UI remains responsive with catalog sizes up to 10,000 models

3. **User Experience**
   - ‚úì Accessibility compliance (WCAG 2.1 AA standard)
   - ‚úì Mobile-responsive design for tablet access
   - ‚úì Intuitive UX requiring <5 minutes for new user onboarding

4. **Documentation & Support**
   - ‚úì User guide with discovery workflow best practices
   - ‚úì Interactive tutorial for first-time users
   - ‚úì API documentation for programmatic model discovery

5. **Testing & Quality**
   - ‚úì >90% test coverage for filtering and comparison logic
   - ‚úì User acceptance testing with 10+ AI Platform Engineers
   - ‚úì A/B testing framework to validate effectiveness metrics

---

## Affected Customers/Partners & Scope

**Primary Beneficiaries:**
- **Current Customers**: 500+ AI Platform Engineers across 75 enterprise accounts
- **Target Customers**: 2,000+ engineers in sales pipeline (specific accounts: Acme Corp, TechGiant Inc., FinancePartners LLC)
- **Partner Ecosystem**: 12 ISV partners who provide pre-trained models to the catalog

**Impact Scope:**
- **Broad Impact**: Enhancement benefits all users of the model catalog, regardless of industry, use case, or experience level
- **High-Priority Segments**:
  - Financial services (35% of user base) - need rapid, compliant model selection
  - Healthcare/Life sciences (20% of user base) - require certified, auditable models
  - Retail/E-commerce (15% of user base) - prioritize cost efficiency and scalability

**Customer Validation:**
- 15 customer interviews conducted (notes attached in research folder)
- Feature request appears in 45 support tickets over past 6 months
- NPS verbatim feedback mentions model discovery pain in 60% of detractor comments
- Beta testing commitments from 8 enterprise customers

**Regional Considerations:**
- Global scope - all regions benefit equally
- Localization may be needed for natural language search (future enhancement)

---

## Alternative Approaches Considered

### Option 1: Enhanced Traditional List View
**Description**: Improve existing list-based UI with better filters and inline metric display
**Why Inadequate**: Doesn't address core issue of information overload; still requires significant manual comparison work; doesn't leverage visual pattern recognition for decision-making

### Option 2: AI-Powered Model Recommendation Chatbot
**Description**: Conversational interface where users describe requirements and receive model suggestions
**Why Inadequate**: Removes user control and transparency; engineers prefer to evaluate options themselves; trust issues with "black box" recommendations; doesn't support exploratory discovery workflows

### Option 3: Spreadsheet Export for External Analysis
**Description**: Provide robust export functionality for users to analyze in Excel/Sheets
**Why Inadequate**: Shifts burden to users; doesn't improve platform experience; data becomes stale; no integration with deployment workflow; poor user experience

### Option 4: Integration with Third-Party Model Hubs
**Description**: Embed external model discovery tools (e.g., Hugging Face, ModelZoo)
**Why Inadequate**: Creates inconsistent UX; requires users to learn multiple tools; doesn't integrate with our deployment infrastructure; licensing and data privacy concerns; doesn't differentiate our platform

**Why New Approach is Needed:**
Existing tools and approaches treat model discovery as a search problem rather than a decision-support problem. Our proposed solution recognizes that engineers need not just to find models, but to confidently select the optimal model through visual comparison, contextual information, and streamlined workflows‚Äîcapabilities that don't exist in current market offerings.

---

## Reference Documents/Links

**User Research:**
- Customer Interview Summary (June 2024): [Link to research folder]
- Platform Engineer Persona Study: [Link to product docs]
- User Journey Maps - Model Discovery: [Link to Miro board]

**Competitive Analysis:**
- Feature Comparison Matrix: [Link to competitive analysis doc]
- Hugging Face Hub UX Review: [Link to analysis]
- AWS SageMaker Model Catalog Analysis: [Link to analysis]

**Technical Resources:**
- Model Catalog API Documentation: [Link to API docs]
- Performance Benchmarking Standards: [Link to standards doc]
- Frontend Component Library: [Link to design system]

**Business Documentation:**
- Market Opportunity Analysis (Q2 2024): [Link to business case]
- Customer Feature Request Tracker: [JIRA-12345]
- Sales Pipeline Impact Report: [Link to sales analysis]

---

**Document Metadata**
**Created by**: Parker (Product Manager) & Archie (Architect)
**Review Status**: Ready for RFE Council Review
**Priority**: High
**Target Release**: Q3 2024
**Last Updated**: ${new Date().toLocaleDateString()}

*Authored by: Parker (Product Manager), Archie (Architect)*
*Based on: idea.md, feasibility.md*`;

            // Type out the RFE document
            const contentElement = document.getElementById('rfe-doc-content');
            typeMessage(contentElement, rfeDocContent, 5, function() {
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Restore the workflow step description
                const workflowStepFilename = document.querySelector('#describe-step .workflow-step-filename');
                if (workflowStepFilename) {
                    workflowStepFilename.innerHTML = 'Create detailed specification';
                }

                // Show action buttons
                const actionsDiv = document.getElementById('rfe-doc-actions');
                if (actionsDiv) {
                    actionsDiv.innerHTML =
                        '<button onclick="copyRFEDocContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>' +
                                '<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>' +
                            '</svg>' +
                            'Copy' +
                        '</button>' +
                        '<button onclick="downloadRFEMd()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>' +
                                '<polyline points="7 10 12 15 17 10"/>' +
                                '<line x1="12" y1="15" x2="12" y2="3"/>' +
                            '</svg>' +
                            'Download' +
                        '</button>' +
                        '<button onclick="openRFEInVSCode()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>' +
                            '</svg>' +
                            'Open in VS Code' +
                        '</button>' +
                        '<button onclick="openRFEInGoogleDocs()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>' +
                                '<polyline points="14 2 14 8 20 8"/>' +
                                '<line x1="16" y1="13" x2="8" y2="13"/>' +
                                '<line x1="16" y1="17" x2="8" y2="17"/>' +
                                '<line x1="10" y1="9" x2="8" y2="9"/>' +
                            '</svg>' +
                            'Open in Google Docs' +
                        '</button>' +
                        '<button onclick="viewRFEDocContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.25rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' +
                                '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>' +
                                '<circle cx="12" cy="12" r="3"/>' +
                            '</svg>' +
                            'View' +
                        '</button>';
                }

                // Add result to Results accordion
                addResultToAccordion('rfe.md was created');

                // Add file to repository file list
                addFileToRepository('rfe.md', '15.2K');
            });
        }

        // Update message count in Session Details
        function updateMessageCount() {
            const chatMessages = document.getElementById('chat-messages');
            if (chatMessages) {
                const messageCount = chatMessages.querySelectorAll('.message').length;
                const messageCountSpan = document.getElementById('message-count');
                if (messageCountSpan) {
                    messageCountSpan.textContent = messageCount;
                }
            }
        }

        // Add file to Spec Repository file list
        function addFileToRepository(filename, filesize) {
            const repoDetails = document.getElementById('repository-details');
            if (!repoDetails) {
                console.log('repository-details not found');
                return;
            }

            // Find the file list container (the div with gray background)
            const fileListContainer = repoDetails.querySelector('div[style*="background: #f8fafc"]');
            if (!fileListContainer) {
                console.log('file list container not found');
                return;
            }

            // Check if file already exists in the list
            const existingFiles = fileListContainer.querySelectorAll('div[style*="display: flex"]');
            for (var i = 0; i < existingFiles.length; i++) {
                if (existingFiles[i].textContent.includes(filename)) {
                    console.log('File already exists: ' + filename);
                    return; // File already exists, don't add duplicate
                }
            }

            // Create new file entry
            const fileEntry = document.createElement('div');
            fileEntry.style.cssText = 'display: flex; justify-content: space-between; padding: 0.25rem 0; color: #64748b;';

            // Make idea.md, feasibility.md, rfe.md, and spec.md clickable
            var filenameHtml = filename;
            if (filename === 'idea.md') {
                filenameHtml = '<a href="#" onclick="viewRFEContent(); return false;" style="color: #64748b; text-decoration: none; cursor: pointer;">' + filename + '</a>';
            } else if (filename === 'feasibility.md') {
                filenameHtml = '<a href="#" onclick="viewFeasibilityContent(); return false;" style="color: #64748b; text-decoration: none; cursor: pointer;">' + filename + '</a>';
            } else if (filename === 'rfe.md') {
                filenameHtml = '<a href="#" onclick="viewRFEDocContent(); return false;" style="color: #64748b; text-decoration: none; cursor: pointer;">' + filename + '</a>';
            } else if (filename === 'spec.md') {
                filenameHtml = '<a href="#" onclick="viewSpecContent(); return false;" style="color: #64748b; text-decoration: none; cursor: pointer;">' + filename + '</a>';
            }

            fileEntry.innerHTML = '<span>' + filenameHtml + '</span><span>' + filesize + '</span>';

            // Find the LICENSE file (first non-directory file) and insert before it
            var insertBeforeElement = null;
            var allDivs = fileListContainer.querySelectorAll('div[style*="display: flex"]');
            for (var j = 0; j < allDivs.length; j++) {
                var spanText = allDivs[j].querySelector('span').textContent;
                if (spanText === 'LICENSE' || (spanText.indexOf('/') === -1 && spanText.indexOf('.') !== -1)) {
                    insertBeforeElement = allDivs[j];
                    break;
                }
            }

            if (insertBeforeElement) {
                fileListContainer.insertBefore(fileEntry, insertBeforeElement);
            } else {
                fileListContainer.appendChild(fileEntry);
            }

            console.log('Added file to repository: ' + filename);
        }

        // Add result to Results accordion
        function addResultToAccordion(message) {
            const resultsContent = document.getElementById('results-content');
            if (resultsContent) {
                // Check if "No results yet" message exists and remove it
                const noResultsMsg = resultsContent.querySelector('div[style*="text-align: center"]');
                if (noResultsMsg && noResultsMsg.textContent.trim() === 'No results yet') {
                    resultsContent.innerHTML = '';
                }

                // Get or create the results list
                let resultsList = resultsContent.querySelector('div[style*="padding: 1rem"]');
                if (!resultsList) {
                    resultsContent.innerHTML = '<div style="padding: 1rem; font-size: 0.875rem; color: #64748b;"></div>';
                    resultsList = resultsContent.querySelector('div');
                }

                // Add new result item with clickable filename and action buttons
                const resultItem = document.createElement('div');
                resultItem.style.cssText = 'margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;';

                // Determine which file type and create appropriate links and buttons
                var messageWithLink = message;
                var actionButtons = '';

                if (message.includes('idea.md')) {
                    messageWithLink = message.replace('idea.md', '<a href="#" onclick="viewRFEContent(); return false;" style="color: #1e40af; text-decoration: underline; cursor: pointer;">idea.md</a>');
                    actionButtons = `
                        <div style="display: flex; gap: 0.25rem; margin-left: auto;">
                            <button onclick="copyRFEContent()" title="Copy" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                            <button onclick="downloadIdeaMd()" title="Download" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                            <button onclick="openIdeaInVSCode()" title="Open in VS Code" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>
                                </svg>
                            </button>
                            <button onclick="openIdeaInGoogleDocs()" title="Open in Google Docs" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                </svg>
                            </button>
                        </div>
                    `;
                } else if (message.includes('feasibility.md')) {
                    messageWithLink = message.replace('feasibility.md', '<a href="#" onclick="viewFeasibilityContent(); return false;" style="color: #1e40af; text-decoration: underline; cursor: pointer;">feasibility.md</a>');
                    actionButtons = `
                        <div style="display: flex; gap: 0.25rem; margin-left: auto;">
                            <button onclick="copyFeasibilityContent()" title="Copy" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                            <button onclick="downloadFeasibilityMd()" title="Download" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                            <button onclick="openFeasibilityInVSCode()" title="Open in VS Code" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>
                                </svg>
                            </button>
                            <button onclick="openFeasibilityInGoogleDocs()" title="Open in Google Docs" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                </svg>
                            </button>
                        </div>
                    `;
                } else if (message.includes('rfe.md')) {
                    messageWithLink = message.replace('rfe.md', '<a href="#" onclick="viewRFEDocContent(); return false;" style="color: #1e40af; text-decoration: underline; cursor: pointer;">rfe.md</a>');
                    actionButtons = `
                        <div style="display: flex; gap: 0.25rem; margin-left: auto;">
                            <button onclick="copyRFEDocContent()" title="Copy" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                </svg>
                            </button>
                            <button onclick="downloadRFEMd()" title="Download" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                            </button>
                            <button onclick="openRFEInVSCode()" title="Open in VS Code" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M16 18l6-6-6-6M8 6l-6 6 6 6"/>
                                </svg>
                            </button>
                            <button onclick="openRFEInGoogleDocs()" title="Open in Google Docs" style="padding: 0.25rem; background: transparent; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#64748b" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                </svg>
                            </button>
                        </div>
                    `;
                } else if (message.includes('spec.md')) {
                    messageWithLink = message.replace('spec.md', '<a href="#" onclick="viewSpecContent(); return false;" style="color: #1e40af; text-decoration: underline; cursor: pointer;">spec.md</a>');
                }

                resultItem.innerHTML = '<span style="flex-shrink: 0;">‚úÖ ' + messageWithLink + '</span>' + actionButtons;
                resultsList.appendChild(resultItem);
            }
        }

        // Copy RFE content to clipboard
        function copyRFEContent() {
            const rfeContent = document.getElementById('rfe-content').textContent;
            navigator.clipboard.writeText(rfeContent).then(function() {
                alert('RFE content copied to clipboard!');
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }

        // Download idea.md file
        function downloadIdeaMd() {
            const ideaContent = document.getElementById('rfe-content').textContent;
            const blob = new Blob([ideaContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'idea.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Open idea.md in VS Code
        function openIdeaInVSCode() {
            const ideaContent = document.getElementById('rfe-content').textContent;

            // Create a temporary download to get the file locally
            const blob = new Blob([ideaContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'idea.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show user-friendly message about opening in VS Code
            setTimeout(() => {
                const shouldOpen = confirm('File downloaded to your Downloads folder.\n\nClick OK to attempt opening VS Code (if installed), or Cancel to open manually.');
                if (shouldOpen) {
                    // Try to use VS Code protocol handler
                    // Note: This may not work in all browsers/systems
                    const vscodeUrl = 'vscode://file/' + encodeURIComponent(navigator.userAgent.includes('Mac') ?
                        '/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/idea.md' :
                        'C:/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/idea.md');
                    window.location.href = vscodeUrl;

                    // Fallback message
                    setTimeout(() => {
                        alert('If VS Code didn\'t open, please:\n1. Locate idea.md in your Downloads folder\n2. Right-click and select "Open with VS Code"\n3. Or drag the file into VS Code');
                    }, 1000);
                }
            }, 500);
        }

        // Open idea.md in Google Docs
        function openIdeaInGoogleDocs() {
            const ideaContent = document.getElementById('rfe-content').textContent;

            // Create a blob and convert to base64 for Google Docs
            const blob = new Blob([ideaContent], { type: 'text/plain' });
            const reader = new FileReader();

            reader.onloadend = function() {
                // Google Docs doesn't have a direct protocol handler like VS Code
                // We'll open Google Docs in a new tab and show instructions
                const googleDocsUrl = 'https://docs.google.com/document/create';
                const newWindow = window.open(googleDocsUrl, '_blank');

                // Copy content to clipboard for easy pasting
                navigator.clipboard.writeText(ideaContent).then(() => {
                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nThe content has been copied to your clipboard.\nPaste it into the new Google Doc (Ctrl/Cmd + V).');
                    }, 500);
                }).catch(() => {
                    // If clipboard fails, download the file instead
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'idea.md';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nFile downloaded to your Downloads folder.\nIn Google Docs, go to File > Open > Upload to import idea.md');
                    }, 500);
                });
            };

            reader.readAsDataURL(blob);
        }

        // View RFE content in new window or modal
        function viewRFEContent() {
            const rfeContent = document.getElementById('rfe-content').textContent;
            const newWindow = window.open('', 'RFE Content', 'width=800,height=600');
            newWindow.document.write('<html><head><title>RFE Content</title>');
            newWindow.document.write('<style>body { font-family: monospace; white-space: pre-wrap; padding: 2rem; }</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(rfeContent);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // View feasibility.md content in new window
        function viewFeasibilityContent() {
            const feasibilityContent = document.getElementById('feasibility-content').textContent;
            const newWindow = window.open('', 'Feasibility Assessment', 'width=800,height=600');
            newWindow.document.write('<html><head><title>Feasibility Assessment</title>');
            newWindow.document.write('<style>body { font-family: monospace; white-space: pre-wrap; padding: 2rem; }</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(feasibilityContent);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // Copy feasibility.md content to clipboard
        function copyFeasibilityContent() {
            const feasibilityContent = document.getElementById('feasibility-content').textContent;
            navigator.clipboard.writeText(feasibilityContent).then(function() {
                alert('Feasibility content copied to clipboard!');
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }

        // Download feasibility.md file
        function downloadFeasibilityMd() {
            const feasibilityContent = document.getElementById('feasibility-content').textContent;
            const blob = new Blob([feasibilityContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'feasibility.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Open feasibility.md in VS Code
        function openFeasibilityInVSCode() {
            const feasibilityContent = document.getElementById('feasibility-content').textContent;

            // Create a temporary download to get the file locally
            const blob = new Blob([feasibilityContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'feasibility.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show user-friendly message about opening in VS Code
            setTimeout(() => {
                const shouldOpen = confirm('File downloaded to your Downloads folder.\n\nClick OK to attempt opening VS Code (if installed), or Cancel to open manually.');
                if (shouldOpen) {
                    // Try to use VS Code protocol handler
                    const vscodeUrl = 'vscode://file/' + encodeURIComponent(navigator.userAgent.includes('Mac') ?
                        '/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/feasibility.md' :
                        'C:/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/feasibility.md');
                    window.location.href = vscodeUrl;

                    // Fallback message
                    setTimeout(() => {
                        alert('If VS Code didn\'t open, please:\n1. Locate feasibility.md in your Downloads folder\n2. Right-click and select "Open with VS Code"\n3. Or drag the file into VS Code');
                    }, 1000);
                }
            }, 500);
        }

        // Open feasibility.md in Google Docs
        function openFeasibilityInGoogleDocs() {
            const feasibilityContent = document.getElementById('feasibility-content').textContent;

            // Create a blob and convert to base64 for Google Docs
            const blob = new Blob([feasibilityContent], { type: 'text/plain' });
            const reader = new FileReader();

            reader.onloadend = function() {
                // Open Google Docs in a new tab
                const googleDocsUrl = 'https://docs.google.com/document/create';
                const newWindow = window.open(googleDocsUrl, '_blank');

                // Copy content to clipboard for easy pasting
                navigator.clipboard.writeText(feasibilityContent).then(() => {
                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nThe content has been copied to your clipboard.\nPaste it into the new Google Doc (Ctrl/Cmd + V).');
                    }, 500);
                }).catch(() => {
                    // If clipboard fails, download the file instead
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'feasibility.md';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nFile downloaded to your Downloads folder.\nIn Google Docs, go to File > Open > Upload to import feasibility.md');
                    }, 500);
                });
            };

            reader.readAsDataURL(blob);
        }

        // View rfe.md content in new window
        function viewRFEDocContent() {
            const rfeDocContent = document.getElementById('rfe-doc-content').textContent;
            const newWindow = window.open('', 'Request for Enhancement', 'width=800,height=600');
            newWindow.document.write('<html><head><title>Request for Enhancement</title>');
            newWindow.document.write('<style>body { font-family: monospace; white-space: pre-wrap; padding: 2rem; }</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(rfeDocContent);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // Copy rfe.md content to clipboard
        function copyRFEDocContent() {
            const rfeDocContent = document.getElementById('rfe-doc-content').textContent;
            navigator.clipboard.writeText(rfeDocContent).then(function() {
                alert('RFE content copied to clipboard!');
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }

        // Download rfe.md file
        function downloadRFEMd() {
            const rfeDocContent = document.getElementById('rfe-doc-content').textContent;
            const blob = new Blob([rfeDocContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rfe.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Open rfe.md in VS Code
        function openRFEInVSCode() {
            const rfeDocContent = document.getElementById('rfe-doc-content').textContent;

            // Create a temporary download to get the file locally
            const blob = new Blob([rfeDocContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rfe.md';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show user-friendly message about opening in VS Code
            setTimeout(() => {
                const shouldOpen = confirm('File downloaded to your Downloads folder.\n\nClick OK to attempt opening VS Code (if installed), or Cancel to open manually.');
                if (shouldOpen) {
                    // Try to use VS Code protocol handler
                    const vscodeUrl = 'vscode://file/' + encodeURIComponent(navigator.userAgent.includes('Mac') ?
                        '/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/rfe.md' :
                        'C:/Users/' + (window.location.pathname.split('/')[2] || 'user') + '/Downloads/rfe.md');
                    window.location.href = vscodeUrl;

                    // Fallback message
                    setTimeout(() => {
                        alert('If VS Code didn\'t open, please:\n1. Locate rfe.md in your Downloads folder\n2. Right-click and select "Open with VS Code"\n3. Or drag the file into VS Code');
                    }, 1000);
                }
            }, 500);
        }

        // Open rfe.md in Google Docs
        function openRFEInGoogleDocs() {
            const rfeDocContent = document.getElementById('rfe-doc-content').textContent;

            // Create a blob and convert to base64 for Google Docs
            const blob = new Blob([rfeDocContent], { type: 'text/plain' });
            const reader = new FileReader();

            reader.onloadend = function() {
                // Open Google Docs in a new tab
                const googleDocsUrl = 'https://docs.google.com/document/create';
                const newWindow = window.open(googleDocsUrl, '_blank');

                // Copy content to clipboard for easy pasting
                navigator.clipboard.writeText(rfeDocContent).then(() => {
                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nThe content has been copied to your clipboard.\nPaste it into the new Google Doc (Ctrl/Cmd + V).');
                    }, 500);
                }).catch(() => {
                    // If clipboard fails, download the file instead
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'rfe.md';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    setTimeout(() => {
                        alert('Opening Google Docs in a new tab.\n\nFile downloaded to your Downloads folder.\nIn Google Docs, go to File > Open > Upload to import rfe.md');
                    }, 500);
                });
            };

            reader.readAsDataURL(blob);
        }

        // Run /specify command
        function runSpecifyCommand() {
            const chatMessages = document.getElementById('chat-messages');

            // Get selected agents
            const selectedAgents = [];
            const agentCheckboxes = document.querySelectorAll('#agents-list input[type="checkbox"]:not(#dynamic-agent-selection)');
            agentCheckboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    const label = checkbox.parentElement.querySelector('span');
                    const agentText = label.textContent;
                    const agentName = agentText.split(' - ')[0];
                    const agentRole = agentText.split(' - ')[1];
                    selectedAgents.push({ name: agentName, role: agentRole });
                }
            });

            // Show system message about collaboration
            const systemMessage = document.createElement('div');
            systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            systemMessage.innerHTML =
                '<div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">' +
                    'Selected agents are collaborating on a spec.md file based on the associated repositories and provided context.' +
                '</div>';

            chatMessages.appendChild(systemMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Show agent contributions if there are selected agents
            if (selectedAgents.length > 0) {
                showSpecifyAgentContributions(selectedAgents, 0, function() {
                    // After all agents have contributed, show spec content
                    showSpecContent();
                });
            } else {
                // No agents selected, just show spec content
                setTimeout(function() {
                    showSpecContent();
                }, 500);
            }
        }

        // Show agent contributions for /specify command
        function showSpecifyAgentContributions(agents, index, callback) {
            if (index >= agents.length) {
                callback();
                return;
            }

            const agent = agents[index];
            const chatMessages = document.getElementById('chat-messages');

            setTimeout(function() {
                const agentMessage = document.createElement('div');
                agentMessage.className = 'message';
                agentMessage.innerHTML =
                    '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">' + agent.name.substring(0, 2).toUpperCase() + '</div>' +
                    '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                        '<div class="message-header">' + agent.name + ' (' + agent.role + ')</div>' +
                        '<div id="spec-agent-' + index + '-message"></div>' +
                    '</div>';

                chatMessages.appendChild(agentMessage);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Update message count
                updateMessageCount();

                // Type out agent's contribution for spec
                const messageElement = document.getElementById('spec-agent-' + index + '-message');
                const contributions = {
                    'Archie': 'I will define the technical architecture and system components for the specification.',
                    'Aria': 'I will map out the complete user journey and interaction patterns.',
                    'Parker': 'I will ensure the spec aligns with product strategy and market needs.',
                    'Uma': 'I will establish design standards and component specifications.',
                    'Felix': 'I will detail the accessibility requirements and component behavior.',
                    'Steve': 'I will specify the visual design requirements and interface patterns.',
                    'Ryan': 'I will incorporate user research findings into the requirements.',
                    'Olivia': 'I will define clear acceptance criteria for each requirement.',
                    'Emma': 'I will ensure the spec is technically feasible and resource-appropriate.',
                    'Lee': 'I will break down the requirements into implementable components.',
                    'Taylor': 'I will review the spec for implementation clarity and practicality.',
                    'Stella': 'I will validate the technical approach and identify potential issues.',
                    'Diego': 'I will outline the documentation requirements for this feature.',
                    'Terry': 'I will ensure user documentation needs are captured in the spec.',
                    'Tessa': 'I will define content structure and information architecture needs.',
                    'Casey': 'I will specify the content strategy and taxonomy requirements.',
                    'Dan': 'I will validate alignment with strategic business objectives.',
                    'Sam': 'I will ensure the spec supports our agile development process.',
                    'Jack': 'I will identify dependencies and delivery milestones.',
                    'Phoenix': 'I will assess upgrade impact and customer migration paths.',
                    'Neil': 'I will define testing requirements and quality criteria.'
                };

                const contribution = contributions[agent.name] || 'I will contribute my expertise as ' + agent.role + ' to this specification.';

                typeMessage(messageElement, contribution, 10, function() {
                    // Move to next agent
                    showSpecifyAgentContributions(agents, index + 1, callback);
                });
            }, 300);
        }

        // Show spec content
        function showSpecContent() {
            const chatMessages = document.getElementById('chat-messages');

            const specMessage = document.createElement('div');
            specMessage.className = 'message';
            specMessage.innerHTML =
                '<div class="message-avatar ai-avatar">ACP</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">ACP</div>' +
                    '<div id="spec-content" style="white-space: pre-wrap; font-family: monospace; font-size: 0.875rem;"></div>' +
                    '<div id="spec-actions" style="display: none; margin-top: 1rem; display: flex; gap: 0.5rem;"></div>' +
                '</div>';

            chatMessages.appendChild(specMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Update message count
            updateMessageCount();

            // Type out the spec content
            const specContentElement = document.getElementById('spec-content');
            var specContent = '# Feature Specification: RHOAI 3.0 Dashboard Redesign\n\n' +
'## Overview\n\n' +
'This specification defines the requirements for redesigning the Red Hat OpenShift AI (RHOAI) 3.0 dashboard to improve model discovery and deployment workflows for AI Platform Engineers.\n\n' +
'## User Stories\n\n' +
'### Primary User Story\n' +
'As an AI Platform Engineer, I want to quickly find and evaluate production-ready AI models so that I can make informed deployment decisions without cognitive overload.\n\n' +
'### Supporting User Stories\n' +
'- As a user, I want to filter models by performance metrics so that I can find models that meet my latency requirements.\n' +
'- As a user, I want to compare multiple models side-by-side so that I can make data-driven selection decisions.\n' +
'- As a user, I want visual representations of model performance so that I can quickly assess model capabilities.\n' +
'- As a user, I want AI-powered recommendations so that I can discover relevant models I might have missed.\n\n' +
'## Functional Requirements\n\n' +
'### FR-1: Advanced Model Filtering\n' +
'The system shall provide interactive filtering capabilities including:\n' +
'- Latency range slider with real-time results\n' +
'- Cost threshold controls with budget indicators\n' +
'- Hardware compatibility selection\n' +
'- Use case category filtering\n' +
'- Multi-criteria combination support\n\n' +
'### FR-2: Model Comparison Interface\n' +
'The system shall enable users to:\n' +
'- Select up to 4 models for comparison\n' +
'- View side-by-side performance metrics\n' +
'- Compare deployment requirements\n' +
'- Export comparison data\n\n' +
'### FR-3: Visual Data Representation\n' +
'The system shall display:\n' +
'- Performance radar charts for model capabilities\n' +
'- Compatibility matrices with visual indicators\n' +
'- Cost visualization with budget tracking\n' +
'- Deployment status with real-time updates\n\n' +
'### FR-4: AI Recommendations\n' +
'The system shall provide:\n' +
'- Context-aware model suggestions\n' +
'- Confidence scores for recommendations\n' +
'- Reasoning explanations for suggestions\n' +
'- Learning from user selections\n\n' +
'## Non-Functional Requirements\n\n' +
'### NFR-1: Performance\n' +
'- Initial page load: < 2 seconds\n' +
'- Filter response time: < 300ms\n' +
'- Support 5000+ models without degradation\n\n' +
'### NFR-2: Accessibility\n' +
'- WCAG 2.1 AA compliance required\n' +
'- Keyboard navigation for all features\n' +
'- Screen reader support with ARIA labels\n' +
'- High contrast mode support\n\n' +
'### NFR-3: Usability\n' +
'- 60% reduction in model discovery time\n' +
'- 4.5/5 minimum user satisfaction score\n' +
'- 80% feature adoption rate\n\n' +
'## Technical Specifications\n\n' +
'### Technology Stack\n' +
'- Frontend: React 18+ with TypeScript\n' +
'- UI Framework: PatternFly React components\n' +
'- Charts: Recharts library\n' +
'- State Management: React Context API\n' +
'- Build Tool: Webpack 5\n\n' +
'### Browser Support\n' +
'- Chrome/Edge: Latest 2 versions\n' +
'- Firefox: Latest 2 versions\n' +
'- Safari: Latest 2 versions\n\n' +
'## Acceptance Criteria\n\n' +
'### AC-1: Filter Functionality\n' +
'Given a user on the dashboard\n' +
'When they adjust filter controls\n' +
'Then results update within 300ms\n' +
'And filter state persists across sessions\n\n' +
'### AC-2: Model Comparison\n' +
'Given a user has selected multiple models\n' +
'When they click compare\n' +
'Then a side-by-side view displays all metrics\n' +
'And they can export the comparison as PDF or CSV\n\n' +
'### AC-3: Accessibility Compliance\n' +
'Given any dashboard feature\n' +
'When tested with accessibility tools\n' +
'Then it passes WCAG 2.1 AA compliance\n' +
'And all interactions work via keyboard\n\n' +
'## Dependencies\n' +
'- Backend API for model metadata\n' +
'- Real-time metrics streaming service\n' +
'- Authentication and authorization system\n' +
'- Analytics and telemetry infrastructure';

            typeMessage(specContentElement, specContent, 5, function() {
                // Scroll to bottom after typing completes
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Show action buttons
                const actionsDiv = document.getElementById('spec-actions');
                if (actionsDiv) {
                    actionsDiv.style.display = 'flex';
                    actionsDiv.innerHTML =
                        '<button onclick="copySpecContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">' +
                                '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>' +
                                '<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>' +
                            '</svg>' +
                            'Copy' +
                        '</button>' +
                        '<button onclick="viewSpecContent()" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.875rem;">' +
                            '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.25rem;">' +
                                '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>' +
                                '<circle cx="12" cy="12" r="3"/>' +
                            '</svg>' +
                            'View' +
                        '</button>';
                }

                // Add result to Results accordion
                addResultToAccordion('spec.md was created');

                // Add file to repository file list
                addFileToRepository('spec.md', '8.7K');
            });
        }

        // Copy spec content to clipboard
        function copySpecContent() {
            const specContent = document.getElementById('spec-content').textContent;
            navigator.clipboard.writeText(specContent).then(function() {
                alert('Spec content copied to clipboard!');
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }

        // View spec content in new window
        function viewSpecContent() {
            const specContent = document.getElementById('spec-content').textContent;
            const newWindow = window.open('', 'Spec Content', 'width=800,height=600');
            newWindow.document.write('<html><head><title>Spec Content</title>');
            newWindow.document.write('<style>body { font-family: monospace; white-space: pre-wrap; padding: 2rem; }</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(specContent);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // View session prompt in new window
        function viewSessionPrompt() {
            var promptContent = 'IMPORTANT: The result of this interactive chat session MUST produce idea.md at the workspace root. The idea.md should be formatted as markdown in the following way:\n\n' +
'# Feature Title\n\n' +
'**Feature Overview:**  \n' +
'*An elevator pitch (value statement) that describes the Feature in a clear, concise way. ie: Executive Summary of the user goal or problem that is being solved, why does this matter to the user? The "What & Why"...* \n\n' +
'* Text\n\n' +
'**Goals:**\n\n' +
'*Provide high-level goal statement, providing user context and expected user outcome(s) for this Feature. Who benefits from this Feature, and how? What is the difference between today\'s current state and a world with this Feature?*\n\n' +
'* Text\n\n' +
'**Out of Scope:**\n\n' +
'*High-level list of items or personas that are out of scope.*\n\n' +
'* Text\n\n' +
'**Requirements:**\n\n' +
'*A list of specific needs, capabilities, or objectives that a Feature must deliver to satisfy the Feature. Some requirements will be flagged as MVP. If an MVP gets shifted, the Feature shifts. If a non MVP requirement slips, it does not shift the feature.*\n\n' +
'* Text\n\n' +
'**Done - Acceptance Criteria:**\n\n' +
'*Acceptance Criteria articulates and defines the value proposition - what is required to meet the goal and intent of this Feature. The Acceptance Criteria provides a detailed definition of scope and the expected outcomes - from a users point of view*\n\n' +
'* Text\n\n' +
'**Use Cases - i.e. User Experience & Workflow:**\n\n' +
'*Include use case diagrams, main success scenarios, alternative flow scenarios.*\n\n' +
'* Text\n\n' +
'**Documentation Considerations:**\n\n' +
'*Provide information that needs to be considered and planned so that documentation will meet customer needs. If the feature extends existing functionality, provide a link to its current documentation..*\n\n' +
'* Text\n\n' +
'**Questions to answer:**\n\n' +
'*Include a list of refinement / architectural questions that may need to be answered before coding can begin.*\n\n' +
'* Text\n\n' +
'**Background & Strategic Fit:**\n\n' +
'*Provide any additional context is needed to frame the feature.*\n\n' +
'* Text\n\n' +
'**Customer Considerations**\n\n' +
'*Provide any additional customer-specific considerations that must be made when designing and delivering the Feature.*\n\n' +
'* Text';

            const newWindow = window.open('', 'Session Prompt', 'width=800,height=600');
            newWindow.document.write('<html><head><title>Session Prompt</title>');
            newWindow.document.write('<style>body { font-family: monospace; white-space: pre-wrap; padding: 2rem; }</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(promptContent);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
        }

        // Handle Enter key press in chat input
        function handleKeyPress(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Send user message to chat
        function sendMessage() {
            var inputField = document.getElementById('chat-input-field');
            var messageText = inputField.value.trim();

            // Don't send empty messages
            if (!messageText) {
                return;
            }

            var chatMessages = document.getElementById('chat-messages');

            // Create user message element
            var userMessage = document.createElement('div');
            userMessage.className = 'message';
            userMessage.innerHTML =
                '<div class="message-avatar user-avatar">DU</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">demo-user@redhat.com</div>' +
                    '<div>' + escapeHtml(messageText) + '</div>' +
                '</div>';

            chatMessages.appendChild(userMessage);

            // Update message count
            updateMessageCount();

            // Clear input field
            inputField.value = '';

            // Scroll to bottom of chat
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // ACP responds after a short delay
            setTimeout(function() {
                showACPResponse(messageText);
            }, 800);
        }

        // Update agent count badge
        function updateAgentCountBadge() {
            var agentCheckboxes = document.querySelectorAll('#agents-list input[type="checkbox"]:not(#dynamic-agent-selection)');
            var checkedCount = 0;

            agentCheckboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    checkedCount++;
                }
            });

            var badge = document.getElementById('agents-count-badge');
            if (badge) {
                badge.textContent = checkedCount;
                if (checkedCount > 0) {
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        // Add agent to session
        function addAgentToSession(agentName) {
            var chatMessages = document.getElementById('chat-messages');

            // Find and check the agent's checkbox in the accordion
            var agentCheckboxes = document.querySelectorAll('#agents-list input[type="checkbox"]:not(#dynamic-agent-selection)');
            var agentInfo = null;

            agentCheckboxes.forEach(function(checkbox) {
                var label = checkbox.parentElement.querySelector('span');
                var agentText = label.textContent;
                var name = agentText.split(' - ')[0].trim();
                var role = agentText.split(' - ')[1].trim();

                if (name.toLowerCase() === agentName.toLowerCase()) {
                    checkbox.checked = true;
                    agentInfo = { name: name, role: role };
                }
            });

            if (!agentInfo) {
                // Agent not found
                return;
            }

            // Update agent count badge
            updateAgentCountBadge();

            // Show system message about agent being added
            var systemMessage = document.createElement('div');
            systemMessage.style.cssText = 'text-align: center; padding: 0.5rem; margin: 1rem 0;';
            systemMessage.innerHTML =
                '<div style="display: inline-block; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 1rem; padding: 0.375rem 0.75rem; font-size: 0.75rem; color: #64748b;">' +
                    agentInfo.name + ' has been added to the session' +
                '</div>';
            chatMessages.appendChild(systemMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Show agent participation message after a delay
            setTimeout(function() {
                showAgentParticipation(agentInfo);
            }, 800);
        }

        // Show agent participation message
        function showAgentParticipation(agent) {
            var chatMessages = document.getElementById('chat-messages');

            var agentMessage = document.createElement('div');
            agentMessage.className = 'message';
            agentMessage.innerHTML =
                '<div class="message-avatar" style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 0.875rem; flex-shrink: 0;">' + agent.name.substring(0, 2).toUpperCase() + '</div>' +
                '<div class="message-content" style="flex: 1; background: #f0fdf4; padding: 0.75rem; border-radius: 0.5rem;">' +
                    '<div class="message-header">' + agent.name + ' (' + agent.role + ')</div>' +
                    '<div id="agent-participation-' + agent.name + '"></div>' +
                '</div>';

            chatMessages.appendChild(agentMessage);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Update message count
            updateMessageCount();

            // Agent participation messages
            var participationMessages = {
                'Archie': 'I\'m ready to provide architectural guidance and technical leadership.',
                'Aria': 'I\'ll help with user experience strategy and journey mapping.',
                'Casey': 'I can assist with content strategy and information architecture.',
                'Dan': 'I\'m here to ensure alignment with strategic business objectives.',
                'Diego': 'I\'ll manage the documentation roadmap and coordinate content strategy.',
                'Emma': 'I\'m ready to coordinate the team and balance technical excellence with delivery.',
                'Felix': 'I can help with component design and accessibility implementation.',
                'Jack': 'I\'ll track dependencies and manage delivery milestones.',
                'Lee': 'I\'m here to facilitate sprint planning and coordinate technical work.',
                'Neil': 'I\'ll ensure testability and verify implementation matches requirements.',
                'Olivia': 'I can define acceptance criteria and prioritize features.',
                'Parker': 'I\'m ready to align this work with product strategy and market needs.',
                'Phoenix': 'I\'ll assess customer impact and plan for smooth upgrade paths.',
                'Ryan': 'I can provide user research insights and validate design decisions.',
                'Sam': 'I\'m here to facilitate the agile process and remove impediments.',
                'Stella': 'I\'ll provide technical leadership and bridge architecture to implementation.',
                'Steve': 'I can create visual designs and prototypes.',
                'Taylor': 'I\'m ready to focus on pragmatic implementation and code quality.',
                'Terry': 'I\'ll create user-centered documentation for this work.',
                'Tessa': 'I can coordinate documentation standards and content quality.',
                'Uma': 'I\'m here to ensure design quality and maintain design system consistency.'
            };

            var message = participationMessages[agent.name] || 'I\'m ready to contribute my expertise to this session.';

            // Type out the agent's participation message
            var messageElement = document.getElementById('agent-participation-' + agent.name);
            typeMessage(messageElement, message, 15, function() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }

        // Show ACP response message
        function showACPResponse(userMessage) {
            var chatMessages = document.getElementById('chat-messages');

            // Check if user message contains agent mention (#AgentName)
            var agentMatch = userMessage.match(/#(\w+)/);
            if (agentMatch) {
                var agentName = agentMatch[1];
                addAgentToSession(agentName);
                return;
            }

            // Check if user message starts with /ideate
            if (userMessage.toLowerCase().indexOf('/ideate') === 0) {
                // Run the ideate command workflow
                runIdeateCommand();
                return;
            }

            // Check if user message starts with /feasibility
            if (userMessage.toLowerCase().indexOf('/feasibility') === 0) {
                // Run the feasibility command workflow
                runFeasibilityCommand();
                return;
            }

            // Check if user message starts with /describe
            if (userMessage.toLowerCase().indexOf('/describe') === 0) {
                // Run the describe command workflow
                runDescribeCommand();
                return;
            }

            // Check if user message starts with /specify
            if (userMessage.toLowerCase().indexOf('/specify') === 0) {
                // Run the specify command workflow
                runSpecifyCommand();
                return;
            }

            var responseText;

            // Check if user message starts with /help
            if (userMessage.toLowerCase().indexOf('/help') === 0) {
                responseText = 'Get started by selecting a workflow. This will provide a structured process for agent collaboration.';
            } else {
                // Array of helpful responses
                var responses = [
                    'I understand. Let me help you with that.',
                    'That\'s a great question. Based on the current workflow, I recommend starting with the ideate phase.',
                    'I can assist with that. Would you like me to guide you through the process?',
                    'Good thinking. Let\'s break that down into manageable steps.',
                    'I\'m here to help. Let me know if you need any clarification on the workflow.',
                    'That makes sense.',
                    'Excellent. I can help coordinate the agents to work on that together.',
                    'I see what you\'re asking. Let me provide some guidance on that.',
                    'Understood.',
                    'That\'s within scope.'
                ];

                // Pick a random response
                var randomIndex = Math.floor(Math.random() * responses.length);
                responseText = responses[randomIndex];
            }

            // Create unique ID for this response
            var uniqueId = 'acp-response-' + Date.now();

            // Create ACP message element
            var acpMessage = document.createElement('div');
            acpMessage.className = 'message';
            acpMessage.innerHTML =
                '<div class="message-avatar ai-avatar">ACP</div>' +
                '<div class="message-content">' +
                    '<div class="message-header">ACP</div>' +
                    '<div id="' + uniqueId + '"></div>' +
                '</div>';

            chatMessages.appendChild(acpMessage);

            // Update message count
            updateMessageCount();

            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Type out the response
            var responseElement = document.getElementById(uniqueId);
            typeMessage(responseElement, responseText, 15, function() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
